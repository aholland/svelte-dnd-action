(function(y,se){typeof exports=="object"&&typeof module<"u"?se(exports):typeof define=="function"&&define.amd?define(["exports"],se):(y=typeof globalThis<"u"?globalThis:y||self,se(y.SvelteDndAction={}))})(this,function(y){"use strict";const se="finalize",It="consider";function ee(e,t,n){e.dispatchEvent(new CustomEvent(se,{detail:{items:t,info:n}}))}function Y(e,t,n){e.dispatchEvent(new CustomEvent(It,{detail:{items:t,info:n}}))}const Ee="draggedEntered",ae="draggedLeft",pe="draggedOverIndex",Pe="draggedLeftDocument",De={LEFT_FOR_ANOTHER:"leftForAnother",OUTSIDE_OF_ANY:"outsideOfAny"};function Rt(e,t,n){e.dispatchEvent(new CustomEvent(Ee,{detail:{indexObj:t,draggedEl:n}}))}function St(e,t,n){e.dispatchEvent(new CustomEvent(ae,{detail:{draggedEl:t,type:De.LEFT_FOR_ANOTHER,theOtherDz:n}}))}function xt(e,t){e.dispatchEvent(new CustomEvent(ae,{detail:{draggedEl:t,type:De.OUTSIDE_OF_ANY}}))}function Nt(e,t,n){e.dispatchEvent(new CustomEvent(pe,{detail:{indexObj:t,draggedEl:n}}))}function Lt(e){window.dispatchEvent(new CustomEvent(Pe,{detail:{draggedEl:e}}))}const v={DRAG_STARTED:"dragStarted",DRAGGED_ENTERED:Ee,DRAGGED_ENTERED_ANOTHER:"dragEnteredAnother",DRAGGED_OVER_INDEX:pe,DRAGGED_LEFT:ae,DRAGGED_LEFT_ALL:"draggedLeftAll",DROPPED_INTO_ZONE:"droppedIntoZone",DROPPED_INTO_ANOTHER:"droppedIntoAnother",DROPPED_OUTSIDE_OF_ANY:"droppedOutsideOfAny",DRAG_STOPPED:"dragStopped"},_={POINTER:"pointer",KEYBOARD:"keyboard"},te="isDndShadowItem",ye="data-is-dnd-shadow-item-internal",Ct="data-is-dnd-shadow-item-hint",Ve="id:dnd-shadow-placeholder-0000",je="dnd-action-dragged-el",we="dndShadowBackupId";let A="id",Te=0;function Ke(){Te++}function Xe(){if(Te===0)throw new Error("Bug! trying to decrement when there are no dropzones");Te--}function Mt(e){if(Te>0)throw new Error("can only override the id key before initialising any dndzone");if(typeof e!="string")throw new Error("item id key has to be a string");f(()=>["overriding item id key name",e]),A=e}function Pt(e){return e[we]?e[we]:e[A]}const Fe=typeof window>"u";let f=()=>{};function Ft(e){e?f=(t,n=console.debug)=>{const i=t();Array.isArray(i)?n(...i):n(i)}:f=()=>{}}function $e(e,t=!0){let n;const i=t?zt(e):e.getBoundingClientRect(),r=getComputedStyle(e),o=r.transform;if(o){let a,s,c,g;if(o.startsWith("matrix3d("))n=o.slice(9,-1).split(/, /),a=+n[0],s=+n[5],c=+n[12],g=+n[13];else if(o.startsWith("matrix("))n=o.slice(7,-1).split(/, /),a=+n[0],s=+n[3],c=+n[4],g=+n[5];else return i;const l=r.transformOrigin,h=i.x-c-(1-a)*parseFloat(l),d=i.y-g-(1-s)*parseFloat(l.slice(l.indexOf(" ")+1)),u=a?i.width/a:e.offsetWidth,m=s?i.height/s:e.offsetHeight;return{x:h,y:d,width:u,height:m,top:d,right:h+u,bottom:d+m,left:h}}else return i}function qe(e){const t=$e(e);return{top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX}}function Je(e){const t=e.getBoundingClientRect();return{top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX}}function Qe(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}function $t(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function be(e,t){return e.y<=t.bottom&&e.y>=t.top&&e.x>=t.left&&e.x<=t.right}function de(e){return Qe(Je(e))}function et(e,t){const n=de(e),i=qe(t);return be(n,i)}function tt(e,t){const n=de(e),i=de(t);return $t(n,i)}function kt(e){const t=Je(e);return t.right<0||t.left>document.documentElement.scrollWidth||t.bottom<0||t.top>document.documentElement.scrollHeight}function zt(e){const t=e.getBoundingClientRect();let n={top:t.top,bottom:t.bottom,left:t.left,right:t.right},i=!1,r=!1,o=e.parentElement;for(;o&&o!==document.body;){const a=window.getComputedStyle(o),s=a.overflowY,c=a.overflowX,g=s==="scroll"||s==="auto",l=c==="scroll"||c==="auto";if(g||l){const h=o.getBoundingClientRect();if(g){const d=Math.max(n.top,h.top),u=Math.min(n.bottom,h.bottom);(d!==n.top||u!==n.bottom)&&(i=!0),n.top=d,n.bottom=u}if(l){const d=Math.max(n.left,h.left),u=Math.min(n.right,h.right);(d!==n.left||u!==n.right)&&(r=!0),n.left=d,n.right=u}}o=o.parentElement}return i||r?{top:n.top,bottom:n.bottom,left:n.left,right:n.right,width:Math.max(0,n.right-n.left),height:Math.max(0,n.bottom-n.top)}:{top:t.top,bottom:t.bottom,left:t.left,right:t.right,width:Math.max(0,t.right-t.left),height:Math.max(0,t.bottom-t.top)}}let ne;function ve(){f(()=>"resetting indexes cache"),ne=new Map}ve();function Gt(e){const t=Array.from(e.children).findIndex(n=>n.getAttribute(ye));if(t>=0)return ne.has(e)||ne.set(e,new Map),ne.get(e).set(t,qe(e.children[t])),t}function Bt(e,t){if(!et(e,t))return null;const n=t.children;if(n.length===0)return{index:0,isProximityBased:!0};const i=Gt(t);for(let a=0;a<n.length;a++)if(et(e,n[a])){const s=ne.has(t)&&ne.get(t).get(a);return s&&!be(de(e),s)?{index:i,isProximityBased:!1}:{index:a,isProximityBased:!1}}let r=Number.MAX_VALUE,o;for(let a=0;a<n.length;a++){const s=tt(e,n[a]);s<r&&(r=s,o=a)}if(n.length>0){const a=n.length,c=n[a-1].cloneNode(!1);c.style.visibility="hidden",c.style.pointerEvents="none",t.appendChild(c),tt(e,c)<r&&(o=a),t.removeChild(c)}return{index:o,isProximityBased:!0}}function $(e){return JSON.stringify(e,null,2)}function _e(e){if(!e)throw new Error("cannot get depth of a falsy node");return nt(e,0)}function nt(e,t=0){return e.parentElement?nt(e.parentElement,t+1):t-1}function Zt(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!{}.hasOwnProperty.call(t,n)||t[n]!==e[n])return!1;return!0}function Ut(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}const Ht=200,it=10;let ke;function Wt(e,t,n=Ht,i){let r,o,a=!1,s;const c=Array.from(t).sort((l,h)=>_e(h)-_e(l));function g(){const l=de(e),h=i.multiScrollIfNeeded();if(!h&&s&&Math.abs(s.x-l.x)<it&&Math.abs(s.y-l.y)<it){ke=window.setTimeout(g,n);return}if(kt(e)){f(()=>"off document"),Lt(e);return}s=l;let d=!1;for(const u of c){h&&ve();const m=Bt(e,u);if(m===null)continue;const{index:C}=m;d=!0,u!==r?(r&&St(r,e,u),Rt(u,m,e),r=u):C!==o&&(Nt(u,m,e),o=C);break}!d&&a&&r?(xt(r,e),r=void 0,o=void 0,a=!1):a=!0,ke=window.setTimeout(g,n)}g()}function Yt(){f(()=>"unobserving"),clearTimeout(ke),ve()}const le=30;function Vt(){let e;function t(){e={directionObj:void 0,stepPx:0}}t();function n(o){const{directionObj:a,stepPx:s}=e;a&&(o.scrollBy(a.x*s,a.y*s),window.requestAnimationFrame(()=>n(o)))}function i(o){return le-o}function r(o,a){if(!a)return!1;const s=jt(o,a),c=!!e.directionObj;if(s===null)return c&&t(),!1;let[g,l]=[!1,!1];return a.scrollHeight>a.clientHeight&&(s.bottom<le?(g=!0,e.directionObj={x:0,y:1},e.stepPx=i(s.bottom)):s.top<le&&(g=!0,e.directionObj={x:0,y:-1},e.stepPx=i(s.top)),!c&&g)||a.scrollWidth>a.clientWidth&&(s.right<le?(l=!0,e.directionObj={x:1,y:0},e.stepPx=i(s.right)):s.left<le&&(l=!0,e.directionObj={x:-1,y:0},e.stepPx=i(s.left)),!c&&l)?(n(a),!0):(t(),!1)}return{scrollIfNeeded:r,resetScrolling:t}}function jt(e,t){const n=t===document.scrollingElement?{top:0,bottom:window.innerHeight,left:0,right:window.innerWidth}:t.getBoundingClientRect();return be(e,n)?{top:e.y-n.top,bottom:n.bottom-e.y,left:e.x-n.left,right:n.right-e.x}:null}function Kt(e=[],t){f(()=>"creating multi-scroller");const n=qt(e),i=Array.from(n).sort((s,c)=>_e(c)-_e(s)),{scrollIfNeeded:r,resetScrolling:o}=Vt();function a(){const s=t();if(!s||!i)return!1;const c=i.filter(g=>be(s,g.getBoundingClientRect())||g===document.scrollingElement);for(let g=0;g<c.length;g++)if(r(s,c[g]))return!0;return!1}return{multiScrollIfNeeded:n.size>0?a:()=>!1,destroy:()=>o()}}function Xt(e){if(!e)return[];const t=[];let n=e;for(;n;){const{overflow:i}=window.getComputedStyle(n);i.split(" ").some(r=>r.includes("auto")||r.includes("scroll"))&&t.push(n),n=n.parentElement}return t}function qt(e){const t=new Set;for(let n of e)Xt(n).forEach(i=>t.add(i));return(document.scrollingElement.scrollHeight>document.scrollingElement.clientHeight||document.scrollingElement.scrollWidth>document.scrollingElement.clientHeight)&&t.add(document.scrollingElement),t}function Jt(e){const t=e.cloneNode(!0),n=[],i=e.tagName==="SELECT",r=i?[e]:[...e.querySelectorAll("select")];for(const s of r)n.push(s.value);if(r.length>0){const s=i?[t]:[...t.querySelectorAll("select")];for(let c=0;c<s.length;c++){const g=s[c],l=n[c],h=g.querySelector(`option[value="${l}"`);h&&h.setAttribute("selected",!0)}}const o=e.tagName==="CANVAS",a=o?[e]:[...e.querySelectorAll("canvas")];if(a.length>0){const s=o?[t]:[...t.querySelectorAll("canvas")];for(let c=0;c<s.length;c++){const g=a[c],l=s[c];l.width=g.width,l.height=g.height,g.width>0&&g.height>0&&l.getContext("2d").drawImage(g,0,0)}}return t}const V=Object.freeze({USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT:"USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT"}),rt={[V.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT]:!1};function Qt(e,t){if(!V[e])throw new Error(`Can't set non existing feature flag ${e}! Supported flags: ${Object.keys(V)}`);rt[e]=!!t}function ot(e){if(!V[e])throw new Error(`Can't get non existing feature flag ${e}! Supported flags: ${Object.keys(V)}`);return rt[e]}const en=.2;function X(e){return`${e} ${en}s ease`}function tn(e,t){const n=e.getBoundingClientRect(),i=Jt(e);st(e,i),i.id=je,i.style.position="fixed";let r=n.top,o=n.left;if(i.style.top=`${r}px`,i.style.left=`${o}px`,t){const a=Qe(n);r-=a.y-t.y,o-=a.x-t.x,window.setTimeout(()=>{i.style.top=`${r}px`,i.style.left=`${o}px`},0)}return i.style.margin="0",i.style.boxSizing="border-box",i.style.height=`${n.height}px`,i.style.width=`${n.width}px`,i.style.transition=`${X("top")}, ${X("left")}, ${X("background-color")}, ${X("opacity")}, ${X("color")} `,window.setTimeout(()=>i.style.transition+=`, ${X("width")}, ${X("height")}`,0),i.style.zIndex="9999",i.style.cursor="grabbing",i}function nn(e){e.style.cursor="grab"}function rn(e,t,n,i){st(t,e);const r=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=r.width-o.width,s=r.height-o.height;if(a||s){const c={left:(n-o.left)/o.width,top:(i-o.top)/o.height};ot(V.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)||(e.style.height=`${r.height}px`,e.style.width=`${r.width}px`),e.style.left=`${parseFloat(e.style.left)-c.left*a}px`,e.style.top=`${parseFloat(e.style.top)-c.top*s}px`}}function st(e,t){const n=window.getComputedStyle(e);Array.from(n).filter(i=>i.startsWith("background")||i.startsWith("padding")||i.startsWith("font")||i.startsWith("text")||i.startsWith("align")||i.startsWith("justify")||i.startsWith("display")||i.startsWith("flex")||i.startsWith("border")||i==="opacity"||i==="color"||i==="list-style-type"||ot(V.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)&&(i==="width"||i==="height")).forEach(i=>t.style.setProperty(i,n.getPropertyValue(i),n.getPropertyPriority(i)))}function on(e,t){e.draggable=!1,e.ondragstart=()=>!1,t?(e.style.userSelect="",e.style.WebkitUserSelect="",e.style.cursor=""):(e.style.userSelect="none",e.style.WebkitUserSelect="none",e.style.cursor="grab")}function at(e){e.style.display="none",e.style.position="fixed",e.style.zIndex="-5"}function sn(e){e.style.visibility="hidden",e.setAttribute(ye,"true")}function an(e){e.style.visibility="",e.removeAttribute(ye)}function Ae(e,t=()=>{},n=()=>[]){e.forEach(i=>{const r=t(i);Object.keys(r).forEach(o=>{i.style[o]=r[o]}),n(i).forEach(o=>i.classList.add(o))})}function Oe(e,t=()=>{},n=()=>[]){e.forEach(i=>{const r=t(i);Object.keys(r).forEach(o=>{i.style[o]=""}),n(i).forEach(o=>i.classList.contains(o)&&i.classList.remove(o))})}function dn(e){const t=e.style.minHeight;e.style.minHeight=window.getComputedStyle(e).getPropertyValue("height");const n=e.style.minWidth;return e.style.minWidth=window.getComputedStyle(e).getPropertyValue("width"),function(){e.style.minHeight=t,e.style.minWidth=n}}const ln="--any--",cn=100,un=20,Ie=3,fn=80,dt={outline:"rgba(255, 255, 102, 0.7) solid 2px"},lt="data-is-dnd-original-dragged-item";let R,T,P,Re,E,Se,ie,b,Z,S,j=!1,ze=!1,Ge,ce=!1,ue=[],fe,U,ge=!1;const k=new Map,D=new Map,Be=new WeakMap;function gn(e,t){f(()=>"registering drop-zone if absent"),k.has(t)||k.set(t,new Set),k.get(t).has(e)||(k.get(t).add(e),Ke())}function ct(e,t){k.get(t).delete(e),Xe(),k.get(t).size===0&&k.delete(t)}function hn(){f(()=>"watching dragged element");const e=k.get(Re);for(const i of e)i.addEventListener(Ee,ut),i.addEventListener(ae,ft),i.addEventListener(pe,gt);window.addEventListener(Pe,re);const t=Math.max(...Array.from(e.keys()).map(i=>D.get(i).dropAnimationDurationMs)),n=t===0?un:Math.max(t,cn);fe=Kt(e,()=>S),Wt(T,e,n*1.07,fe)}function mn(){f(()=>"unwatching dragged element");const e=k.get(Re);for(const t of e)t.removeEventListener(Ee,ut),t.removeEventListener(ae,ft),t.removeEventListener(pe,gt);window.removeEventListener(Pe,re),fe&&(fe.destroy(),fe=void 0),Yt()}function xe(e){return e.findIndex(t=>!!t[te])}function En(e){return{...e,[te]:!0,[A]:Ve,[we]:e[A]}}function ut(e){f(()=>["dragged entered",e.currentTarget,e.detail]);let{items:t,dropFromOthersDisabled:n}=D.get(e.currentTarget);if(n&&e.currentTarget!==E){f(()=>"ignoring dragged entered because drop is currently disabled");return}if(ce=!1,t=t.filter(r=>!r[te]),f(()=>`dragged entered items ${$(t)}`),E!==e.currentTarget){const o=D.get(E).items.filter(a=>!a[te]);Y(E,o,{trigger:v.DRAGGED_ENTERED_ANOTHER,id:P[A],source:_.POINTER})}const{index:i}=e.detail.indexObj;b=e.currentTarget,t.splice(i,0,ie),Y(e.currentTarget,t,{trigger:v.DRAGGED_ENTERED,id:P[A],source:_.POINTER})}function ft(e){if(!j)return;f(()=>["dragged left",e.currentTarget,e.detail]);const{items:t,dropFromOthersDisabled:n}=D.get(e.currentTarget);if(n&&e.currentTarget!==E&&e.currentTarget!==b){f(()=>"drop is currently disabled");return}const i=[...t],r=xe(i);r!==-1&&i.splice(r,1);const o=b;b=void 0;const{type:a,theOtherDz:s}=e.detail;if(a===De.OUTSIDE_OF_ANY||a===De.LEFT_FOR_ANOTHER&&s!==E&&D.get(s).dropFromOthersDisabled){f(()=>"dragged left all, putting shadow element back in the origin dz"),ce=!0,b=E;const c=o===E?i:[...D.get(E).items];c.splice(Se,0,ie),Y(E,c,{trigger:v.DRAGGED_LEFT_ALL,id:P[A],source:_.POINTER})}Y(e.currentTarget,i,{trigger:v.DRAGGED_LEFT,id:P[A],source:_.POINTER})}function gt(e){f(()=>["dragged is over index",e.currentTarget,e.detail]);const{items:t,dropFromOthersDisabled:n}=D.get(e.currentTarget);if(n&&e.currentTarget!==E){f(()=>"drop is currently disabled");return}const i=[...t];ce=!1;const{index:r}=e.detail.indexObj,o=xe(i);o!==-1&&i.splice(o,1),i.splice(r,0,ie),Y(e.currentTarget,i,{trigger:v.DRAGGED_OVER_INDEX,id:P[A],source:_.POINTER})}function Ne(e){e.preventDefault();const t=e.touches?e.touches[0]:e;S={x:t.clientX,y:t.clientY},T.style.transform=`translate3d(${S.x-Z.x}px, ${S.y-Z.y}px, 0)`}function re(){f(()=>"dropped"),ze=!0,window.removeEventListener("mousemove",Ne),window.removeEventListener("touchmove",Ne),window.removeEventListener("mouseup",re),window.removeEventListener("touchend",re),mn(),nn(T),b||(f(()=>"element was dropped right after it left origin but before entering somewhere else"),b=E),f(()=>["dropped in dz",b]);let{items:e,type:t}=D.get(b);Oe(k.get(t),r=>D.get(r).dropTargetStyle,r=>D.get(r).dropTargetClasses);let n=xe(e);n===-1&&b===E&&(n=Se),e=e.map(r=>r[te]?P:r);function i(){Ge(),ee(b,e,{trigger:ce?v.DROPPED_OUTSIDE_OF_ANY:v.DROPPED_INTO_ZONE,id:P[A],source:_.POINTER}),b!==E&&ee(E,D.get(E).items,{trigger:v.DROPPED_INTO_ANOTHER,id:P[A],source:_.POINTER});const r=Array.from(b.children).find(o=>o.getAttribute(ye));r&&an(r),yn()}D.get(b).dropAnimationDisabled?i():pn(n,i)}function pn(e,t){const n=e>-1?$e(b.children[e],!1):$e(b,!1),i={x:n.left-parseFloat(T.style.left),y:n.top-parseFloat(T.style.top)},{dropAnimationDurationMs:r}=D.get(b),o=`transform ${r}ms ease`;T.style.transition=T.style.transition?T.style.transition+","+o:o,T.style.transform=`translate3d(${i.x}px, ${i.y}px, 0)`,window.setTimeout(t,r)}function Dn(e,t){ue.push({dz:e,destroy:t}),window.requestAnimationFrame(()=>{at(e),document.body.appendChild(e)})}function yn(){T&&T.remove&&T.remove(),R&&R.remove&&R.remove(),T=void 0,R=void 0,P=void 0,Re=void 0,E=void 0,Se=void 0,ie=void 0,b=void 0,Z=void 0,S=void 0,j=!1,ze=!1,Ge=void 0,ce=!1,U&&clearTimeout(U),U=void 0,ge=!1,ue.length&&(f(()=>["will destroy zones that were removed during drag",ue]),ue.forEach(({dz:e,destroy:t})=>{t(),e.remove()}),ue=[])}function wn(e,t){let n=!1;const i={items:void 0,type:void 0,flipDurationMs:0,dragDisabled:!1,morphDisabled:!1,dropFromOthersDisabled:!1,dropTargetStyle:dt,dropTargetClasses:[],transformDraggedElement:()=>{},centreDraggedOnCursor:!1,dropAnimationDisabled:!1,delayTouchStartMs:0};f(()=>[`dndzone good to go options: ${$(t)}, config: ${$(i)}`,{node:e}]);let r=new Map;function o(){window.addEventListener("mousemove",c,{passive:!1}),window.addEventListener("touchmove",c,{passive:!1,capture:!1}),window.addEventListener("mouseup",s,{passive:!1}),window.addEventListener("touchend",s,{passive:!1})}function a(){window.removeEventListener("mousemove",c),window.removeEventListener("touchmove",c),window.removeEventListener("mouseup",s),window.removeEventListener("touchend",s),U&&(clearTimeout(U),U=void 0,ge=!1)}function s(d){if(a(),R=void 0,Z=void 0,S=void 0,d.type==="touchend"){const u=new Event("click",{bubbles:!0,cancelable:!0});d.target.dispatchEvent(u)}}function c(d){const u=!!d.touches,m=u?d.touches[0]:d;if(u&&i.delayTouchStartMs>0&&!ge){S={x:m.clientX,y:m.clientY},(Math.abs(S.x-Z.x)>=Ie||Math.abs(S.y-Z.y)>=Ie)&&(U&&(clearTimeout(U),U=void 0),s(d));return}d.preventDefault(),S={x:m.clientX,y:m.clientY},(Math.abs(S.x-Z.x)>=Ie||Math.abs(S.y-Z.y)>=Ie)&&(a(),l())}function g(d){if(d.target!==d.currentTarget&&(d.target.value!==void 0||d.target.isContentEditable)){f(()=>"won't initiate drag on a nested input element");return}if(d.button){f(()=>`ignoring none left click button: ${d.button}`);return}if(j){f(()=>"cannot start a new drag before finalizing previous one");return}const u=!!d.touches,m=u&&i.delayTouchStartMs>0;m||d.preventDefault(),d.stopPropagation();const C=u?d.touches[0]:d;Z={x:C.clientX,y:C.clientY},S={...Z},R=d.currentTarget,m&&(ge=!1,U=window.setTimeout(()=>{R&&(ge=!0,a(),l())},i.delayTouchStartMs)),o()}function l(){f(()=>[`drag start config: ${$(i)}`,R]),j=!0,ve();const d=r.get(R);Se=d,E=R.parentElement;const u=E.closest("dialog")||E.closest("[popover]")||E.getRootNode(),m=u.body||u,{items:C,type:W,centreDraggedOnCursor:H}=i,N=[...C];P=N[d],Re=W,ie=En(P),T=tn(R,H&&S),m.appendChild(T);function L(){if(!R){f(()=>"originalDragTarget became undefined, aborting keepOriginalElementInDom");return}R.parentElement?window.requestAnimationFrame(L):(R.setAttribute(lt,!0),m.appendChild(R),hn(),at(R),T.focus())}window.requestAnimationFrame(L),Ae(Array.from(k.get(i.type)).filter(p=>p===E||!D.get(p).dropFromOthersDisabled),p=>D.get(p).dropTargetStyle,p=>D.get(p).dropTargetClasses),N.splice(d,1,ie),Ge=dn(E),Y(E,N,{trigger:v.DRAG_STARTED,id:P[A],source:_.POINTER}),window.addEventListener("mousemove",Ne,{passive:!1}),window.addEventListener("touchmove",Ne,{passive:!1,capture:!1}),window.addEventListener("mouseup",re,{passive:!1}),window.addEventListener("touchend",re,{passive:!1})}function h({items:d=void 0,flipDurationMs:u=0,type:m=ln,dragDisabled:C=!1,morphDisabled:W=!1,dropFromOthersDisabled:H=!1,dropTargetStyle:N=dt,dropTargetClasses:L=[],transformDraggedElement:p=()=>{},centreDraggedOnCursor:Ln=!1,dropAnimationDisabled:Cn=!1,delayTouchStart:me=!1}){i.dropAnimationDurationMs=u;let Ye=0;me===!0?Ye=fn:typeof me=="number"&&isFinite(me)&&me>=0&&(Ye=me),i.delayTouchStartMs=Ye,i.type&&m!==i.type&&ct(e,i.type),i.type=m,i.items=[...d],i.dragDisabled=C,i.morphDisabled=W,i.transformDraggedElement=p,i.centreDraggedOnCursor=Ln,i.dropAnimationDisabled=Cn,n&&j&&!ze&&(!Zt(N,i.dropTargetStyle)||!Ut(L,i.dropTargetClasses))&&(Oe([e],()=>i.dropTargetStyle,()=>L),Ae([e],()=>N,()=>L)),i.dropTargetStyle=N,i.dropTargetClasses=[...L];function Me(I,M){return D.get(I)?D.get(I)[M]:i[M]}n&&j&&i.dropFromOthersDisabled!==H&&(H?Oe([e],I=>Me(I,"dropTargetStyle"),I=>Me(I,"dropTargetClasses")):Ae([e],I=>Me(I,"dropTargetStyle"),I=>Me(I,"dropTargetClasses"))),i.dropFromOthersDisabled=H,D.set(e,i),gn(e,m);const Mn=j?xe(i.items):-1;for(let I=0;I<e.children.length;I++){const M=e.children[I];if(on(M,C),I===Mn){W||rn(T,M,S.x,S.y),i.transformDraggedElement(T,P,I),sn(M);continue}M.removeEventListener("mousedown",Be.get(M)),M.removeEventListener("touchstart",Be.get(M)),C||(M.addEventListener("mousedown",g),M.addEventListener("touchstart",g),Be.set(M,g)),r.set(M,I),n||(n=!0)}}return h(t),{update:d=>{f(()=>`pointer dndzone will update newOptions: ${$(d)}`),h(d)},destroy:()=>{function d(){f(()=>"pointer dndzone will destroy"),ct(e,D.get(e).type),D.delete(e)}j&&!e.closest(`[${lt}]`)?(f(()=>"pointer dndzone will be scheduled for destruction"),Dn(e,d)):d()}}}const Ze={DND_ZONE_ACTIVE:"dnd-zone-active",DND_ZONE_DRAG_DISABLED:"dnd-zone-drag-disabled"},ht={[Ze.DND_ZONE_ACTIVE]:"Tab to one the items and press space-bar or enter to start dragging it",[Ze.DND_ZONE_DRAG_DISABLED]:"This is a disabled drag and drop list"},Tn="dnd-action-aria-alert";let w;function Ue(){w||(w=document.createElement("div"),function(){w.id=Tn,w.style.position="fixed",w.style.bottom="0",w.style.left="0",w.style.zIndex="-5",w.style.opacity="0",w.style.height="0",w.style.width="0",w.setAttribute("role","alert")}(),document.body.prepend(w),Object.entries(ht).forEach(([e,t])=>document.body.prepend(_n(e,t))))}function bn(){return Fe?null:(document.readyState==="complete"?Ue():window.addEventListener("DOMContentLoaded",Ue),{...Ze})}function vn(){Fe||!w||(Object.keys(ht).forEach(e=>document.getElementById(e)?.remove()),w.remove(),w=void 0)}function _n(e,t){const n=document.createElement("div");return n.id=e,n.innerHTML=`<p>${t}</p>`,n.style.display="none",n.style.position="fixed",n.style.zIndex="-5",n}function q(e){if(Fe)return;w||Ue(),w.innerHTML="";const t=document.createTextNode(e);w.appendChild(t),w.style.display="none",w.style.display="inline"}const An="--any--",mt={outline:"rgba(255, 255, 102, 0.7) solid 2px"};let F=!1,He,x,J="",Q,z,K="";const Le=new WeakSet,Et=new WeakMap,pt=new WeakMap,We=new Map,O=new Map,G=new Map;let Ce;function On(e,t){f(()=>"registering drop-zone if absent"),G.size===0&&(f(()=>"adding global keydown and click handlers"),Ce=bn(),window.addEventListener("keydown",yt),window.addEventListener("click",wt)),G.has(t)||G.set(t,new Set),G.get(t).has(e)||(G.get(t).add(e),Ke())}function Dt(e,t){f(()=>"unregistering drop-zone"),x===e&&he(),G.get(t).delete(e),Xe(),G.get(t).size===0&&G.delete(t),G.size===0&&(f(()=>"removing global keydown and click handlers"),window.removeEventListener("keydown",yt),window.removeEventListener("click",wt),Ce=void 0,vn())}function yt(e){if(F)switch(e.key){case"Escape":{he();break}}}function wt(){F&&(Le.has(document.activeElement)||(f(()=>"clicked outside of any draggable"),he()))}function In(e){if(f(()=>"zone focus"),!F)return;const t=e.currentTarget;if(t===x)return;J=t.getAttribute("aria-label")||"";const{items:n}=O.get(x),i=n.find(g=>g[A]===z),r=n.indexOf(i),o=n.splice(r,1)[0],{items:a,autoAriaDisabled:s}=O.get(t);t.getBoundingClientRect().top<x.getBoundingClientRect().top||t.getBoundingClientRect().left<x.getBoundingClientRect().left?(a.push(o),s||q(`Moved item ${K} to the end of the list ${J}`)):(a.unshift(o),s||q(`Moved item ${K} to the beginning of the list ${J}`)),ee(x,n,{trigger:v.DROPPED_INTO_ANOTHER,id:z,source:_.KEYBOARD}),ee(t,a,{trigger:v.DROPPED_INTO_ZONE,id:z,source:_.KEYBOARD}),x=t}function Tt(){We.forEach(({update:e},t)=>e(O.get(t)))}function he(e=!0){f(()=>"drop"),O.get(x).autoAriaDisabled||q(`Stopped dragging item ${K}`),Le.has(document.activeElement)&&document.activeElement.blur(),e&&Y(x,O.get(x).items,{trigger:v.DRAG_STOPPED,id:z,source:_.KEYBOARD}),Oe(G.get(He),t=>O.get(t).dropTargetStyle,t=>O.get(t).dropTargetClasses),Q=null,z=null,K="",He=null,x=null,J="",F=!1,Tt()}function Rn(e,t){const n={items:void 0,type:void 0,dragDisabled:!1,zoneTabIndex:0,zoneItemTabIndex:0,dropFromOthersDisabled:!1,dropTargetStyle:mt,dropTargetClasses:[],autoAriaDisabled:!1};function i(l,h,d){l.length<=1||l.splice(d,1,l.splice(h,1,l[d])[0])}function r(l){switch(f(()=>["handling key down",l.key]),l.key){case"Enter":case" ":{if((l.target.disabled!==void 0||l.target.href||l.target.isContentEditable)&&!Le.has(l.target))return;l.preventDefault(),l.stopPropagation(),F?he():o(l);break}case"ArrowDown":case"ArrowRight":{if(!F)return;l.preventDefault(),l.stopPropagation();const{items:h}=O.get(e),d=Array.from(e.children),u=d.indexOf(l.currentTarget);f(()=>["arrow down",u]),u<d.length-1&&(n.autoAriaDisabled||q(`Moved item ${K} to position ${u+2} in the list ${J}`),i(h,u,u+1),ee(e,h,{trigger:v.DROPPED_INTO_ZONE,id:z,source:_.KEYBOARD}));break}case"ArrowUp":case"ArrowLeft":{if(!F)return;l.preventDefault(),l.stopPropagation();const{items:h}=O.get(e),u=Array.from(e.children).indexOf(l.currentTarget);f(()=>["arrow up",u]),u>0&&(n.autoAriaDisabled||q(`Moved item ${K} to position ${u} in the list ${J}`),i(h,u,u-1),ee(e,h,{trigger:v.DROPPED_INTO_ZONE,id:z,source:_.KEYBOARD}));break}}}function o(l){f(()=>"drag start"),s(l.currentTarget),x=e,He=n.type,F=!0;const h=Array.from(G.get(n.type)).filter(d=>d===x||!O.get(d).dropFromOthersDisabled);if(Ae(h,d=>O.get(d).dropTargetStyle,d=>O.get(d).dropTargetClasses),!n.autoAriaDisabled){let d=`Started dragging item ${K}. Use the arrow keys to move it within its list ${J}`;h.length>1&&(d+=", or tab to another list in order to move the item into it"),q(d)}Y(e,O.get(e).items,{trigger:v.DRAG_STARTED,id:z,source:_.KEYBOARD}),Tt()}function a(l){F&&l.currentTarget!==Q&&(l.stopPropagation(),he(!1),o(l))}function s(l){const{items:h}=O.get(e),d=Array.from(e.children),u=d.indexOf(l);Q=l,Q.tabIndex=n.zoneItemTabIndex,z=h[u][A],K=d[u].getAttribute("aria-label")||""}function c({items:l=[],type:h=An,dragDisabled:d=!1,zoneTabIndex:u=0,zoneItemTabIndex:m=0,dropFromOthersDisabled:C=!1,dropTargetStyle:W=mt,dropTargetClasses:H=[],autoAriaDisabled:N=!1}){n.items=[...l],n.dragDisabled=d,n.dropFromOthersDisabled=C,n.zoneTabIndex=u,n.zoneItemTabIndex=m,n.dropTargetStyle=W,n.dropTargetClasses=H,n.autoAriaDisabled=N,n.type&&h!==n.type&&Dt(e,n.type),n.type=h,On(e,h),N||(e.setAttribute("aria-disabled",d),e.setAttribute("role","list"),e.setAttribute("aria-describedby",d?Ce.DND_ZONE_DRAG_DISABLED:Ce.DND_ZONE_ACTIVE)),O.set(e,n),F?e.tabIndex=e===x||Q.contains(e)||n.dropFromOthersDisabled||x&&n.type!==O.get(x).type?-1:0:e.tabIndex=n.zoneTabIndex,e.addEventListener("focus",In);for(let L=0;L<e.children.length;L++){const p=e.children[L];Le.add(p),p.tabIndex=F?-1:n.zoneItemTabIndex,N||p.setAttribute("role","listitem"),p.removeEventListener("keydown",Et.get(p)),p.removeEventListener("click",pt.get(p)),d||(p.addEventListener("keydown",r),Et.set(p,r),p.addEventListener("click",a),pt.set(p,a)),F&&n.items[L][A]===z&&(f(()=>["focusing on",{i:L,focusedItemId:z}]),Q=p,Q.tabIndex=n.zoneItemTabIndex,p.focus())}}c(t);const g={update:l=>{f(()=>`keyboard dndzone will update newOptions: ${$(l)}`),c(l)},destroy:()=>{f(()=>"keyboard dndzone will destroy"),Dt(e,n.type),O.delete(e),We.delete(e)}};return We.set(e,g),g}function bt(e,t){if(Sn(e))return{update:()=>{},destroy:()=>{}};vt(t);const n=wn(e,t),i=Rn(e,t);return{update:r=>{vt(r),n.update(r),i.update(r)},destroy:()=>{n.destroy(),i.destroy()}}}function Sn(e){return!!e.closest(`[${Ct}="true"]`)}function vt(e){const{items:t,flipDurationMs:n,type:i,dragDisabled:r,morphDisabled:o,dropFromOthersDisabled:a,zoneTabIndex:s,zoneItemTabIndex:c,dropTargetStyle:g,dropTargetClasses:l,transformDraggedElement:h,autoAriaDisabled:d,centreDraggedOnCursor:u,delayTouchStart:m,dropAnimationDisabled:C,...W}=e;if(Object.keys(W).length>0&&console.warn("dndzone will ignore unknown options",W),!t)throw new Error("no 'items' key provided to dndzone");const H=t.find(N=>!(A in N));if(H)throw new Error(`missing '${A}' property for item ${$(H)}`);if(l&&!Array.isArray(l))throw new Error(`dropTargetClasses should be an array but instead it is a ${typeof l}, ${$(l)}`);if(s&&!_t(s))throw new Error(`zoneTabIndex should be a number but instead it is a ${typeof s}, ${$(s)}`);if(c&&!_t(c))throw new Error(`zoneItemTabIndex should be a number but instead it is a ${typeof c}, ${$(c)}`);if(m!==void 0&&m!==!1){const N=m===!0,L=typeof m=="number"&&isFinite(m)&&m>=0;if(!N&&!L)throw new Error(`delayTouchStart should be a boolean (true/false) or a non-negative number but instead it is a ${typeof m}, ${$(m)}`)}}function _t(e){return!isNaN(e)&&function(t){return(t|0)===t}(parseFloat(e))}function At(e){let t=e;const n=new Set;return{get:()=>t,set:i=>{t=i,Array.from(n).forEach(r=>r(t))},subscribe:i=>{n.add(i),i(t)},unsubscribe:i=>{n.delete(i)}}}const B=At(!0),oe=At(!1);function Ot(){return{dragDisabled:oe.get()||B.get(),zoneItemTabIndex:-1}}function xn(e,t){oe.set(t?.dragDisabled??!1);let n=t;const i=bt(e,{...n,...Ot()});function r(){i.update({...n,...Ot()})}B.subscribe(r);function o(s){const{info:{source:c,trigger:g}}=s.detail;c===_.KEYBOARD&&g===v.DRAG_STOPPED&&B.set(!0)}function a(s){const{info:{source:c}}=s.detail;c===_.POINTER&&B.set(!0)}return e.addEventListener("consider",o),e.addEventListener("finalize",a),{update:s=>{n=s,oe.set(n?.dragDisabled??!1),r()},destroy:()=>{e.removeEventListener("consider",o),e.removeEventListener("finalize",a),B.unsubscribe(r)}}}function Nn(e){e.setAttribute("role","button");function t(o){o.preventDefault(),B.set(!1),window.addEventListener("mouseup",i),window.addEventListener("touchend",i)}function n(o){(o.key==="Enter"||o.key===" ")&&B.set(!1)}function i(){B.set(!0),window.removeEventListener("mouseup",i),window.removeEventListener("touchend",i)}const r=()=>{const o=oe.get(),a=B.get();o?(e.tabIndex=-1,e.style.cursor=""):(e.tabIndex=a?0:-1,e.style.cursor=a?"grab":"grabbing")};return oe.subscribe(r),B.subscribe(r),e.addEventListener("mousedown",t),e.addEventListener("touchstart",t),e.addEventListener("keydown",n),{update:()=>{},destroy:()=>{e.removeEventListener("mousedown",t),e.removeEventListener("touchstart",t),e.removeEventListener("keydown",n),oe.unsubscribe(r),B.unsubscribe(r)}}}y.DRAGGED_ELEMENT_ID=je,y.FEATURE_FLAG_NAMES=V,y.SHADOW_BACKUP_ID_PROPERTY_NAME=we,y.SHADOW_ITEM_MARKER_PROPERTY_NAME=te,y.SHADOW_PLACEHOLDER_ITEM_ID=Ve,y.SOURCES=_,y.TRIGGERS=v,y.alertToScreenReader=q,y.dndzone=bt,y.dragHandle=Nn,y.dragHandleZone=xn,y.getOriginallySuppliedItemId=Pt,y.overrideItemIdKeyNameBeforeInitialisingDndZones=Mt,y.setDebugMode=Ft,y.setFeatureFlag=Qt,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.js.map
