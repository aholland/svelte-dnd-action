(function(w,se){typeof exports=="object"&&typeof module<"u"?se(exports):typeof define=="function"&&define.amd?define(["exports"],se):(w=typeof globalThis<"u"?globalThis:w||self,se(w.SvelteDndAction={}))})(this,function(w){"use strict";const se="finalize",Ot="consider";function ee(e,t,n){e.dispatchEvent(new CustomEvent(se,{detail:{items:t,info:n}}))}function Y(e,t,n){e.dispatchEvent(new CustomEvent(Ot,{detail:{items:t,info:n}}))}const me="draggedEntered",ae="draggedLeft",pe="draggedOverIndex",Me="draggedLeftDocument",De={LEFT_FOR_ANOTHER:"leftForAnother",OUTSIDE_OF_ANY:"outsideOfAny"};function It(e,t,n){e.dispatchEvent(new CustomEvent(me,{detail:{indexObj:t,draggedEl:n}}))}function Rt(e,t,n){e.dispatchEvent(new CustomEvent(ae,{detail:{draggedEl:t,type:De.LEFT_FOR_ANOTHER,theOtherDz:n}}))}function St(e,t){e.dispatchEvent(new CustomEvent(ae,{detail:{draggedEl:t,type:De.OUTSIDE_OF_ANY}}))}function xt(e,t,n){e.dispatchEvent(new CustomEvent(pe,{detail:{indexObj:t,draggedEl:n}}))}function Nt(e){window.dispatchEvent(new CustomEvent(Me,{detail:{draggedEl:e}}))}const v={DRAG_STARTED:"dragStarted",DRAGGED_ENTERED:me,DRAGGED_ENTERED_ANOTHER:"dragEnteredAnother",DRAGGED_OVER_INDEX:pe,DRAGGED_LEFT:ae,DRAGGED_LEFT_ALL:"draggedLeftAll",DROPPED_INTO_ZONE:"droppedIntoZone",DROPPED_INTO_ANOTHER:"droppedIntoAnother",DROPPED_OUTSIDE_OF_ANY:"droppedOutsideOfAny",DRAG_STOPPED:"dragStopped"},_={POINTER:"pointer",KEYBOARD:"keyboard"},te="isDndShadowItem",ye="data-is-dnd-shadow-item-internal",Lt="data-is-dnd-shadow-item-hint",Ye="id:dnd-shadow-placeholder-0000",Ve="dnd-action-dragged-el",je="dndPermanentId";let I="id",we=0;function Ke(){we++}function Xe(){if(we===0)throw new Error("Bug! trying to decrement when there are no dropzones");we--}function Mt(e){if(we>0)throw new Error("can only override the id key before initialising any dndzone");if(typeof e!="string")throw new Error("item id key has to be a string");u(()=>["overriding item id key name",e]),I=e}const Ce=typeof window>"u";let u=()=>{};function Ct(e){e?u=(t,n=console.debug)=>{const i=t();Array.isArray(i)?n(...i):n(i)}:u=()=>{}}function Pe(e,t=!0){let n;const i=t?kt(e):e.getBoundingClientRect(),r=getComputedStyle(e),o=r.transform;if(o){let a,s,c,g;if(o.startsWith("matrix3d("))n=o.slice(9,-1).split(/, /),a=+n[0],s=+n[5],c=+n[12],g=+n[13];else if(o.startsWith("matrix("))n=o.slice(7,-1).split(/, /),a=+n[0],s=+n[3],c=+n[4],g=+n[5];else return i;const l=r.transformOrigin,h=i.x-c-(1-a)*parseFloat(l),d=i.y-g-(1-s)*parseFloat(l.slice(l.indexOf(" ")+1)),f=a?i.width/a:e.offsetWidth,E=s?i.height/s:e.offsetHeight;return{x:h,y:d,width:f,height:E,top:d,right:h+f,bottom:d+E,left:h}}else return i}function qe(e){const t=Pe(e);return{top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX}}function Je(e){const t=e.getBoundingClientRect();return{top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX}}function Qe(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}function Pt(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Te(e,t){return e.y<=t.bottom&&e.y>=t.top&&e.x>=t.left&&e.x<=t.right}function de(e){return Qe(Je(e))}function et(e,t){const n=de(e),i=qe(t);return Te(n,i)}function Ft(e,t){const n=de(e),i=de(t);return Pt(n,i)}function $t(e){const t=Je(e);return t.right<0||t.left>document.documentElement.scrollWidth||t.bottom<0||t.top>document.documentElement.scrollHeight}function kt(e){let t=e.getBoundingClientRect(),n={top:t.top,bottom:t.bottom,left:t.left,right:t.right},i=e.parentElement;for(;i&&i!==document.body;){let r=i.getBoundingClientRect();const o=window.getComputedStyle(i).overflowY,a=window.getComputedStyle(i).overflowX,s=o==="scroll"||o==="auto",c=a==="scroll"||a==="auto";s&&(n.top=Math.max(n.top,r.top),n.bottom=Math.min(n.bottom,r.bottom)),c&&(n.left=Math.max(n.left,r.left),n.right=Math.min(n.right,r.right)),i=i.parentElement}return n.top=Math.max(n.top,0),n.bottom=Math.min(n.bottom,window.innerHeight),n.left=Math.max(n.left,0),n.right=Math.min(n.right,window.innerWidth),{top:n.top,bottom:n.bottom,left:n.left,right:n.right,width:Math.max(0,n.right-n.left),height:Math.max(0,n.bottom-n.top)}}let ne;function Fe(){u(()=>"resetting indexes cache"),ne=new Map}Fe();function zt(e){const t=Array.from(e.children).findIndex(n=>n.getAttribute(ye));if(t>=0)return ne.has(e)||ne.set(e,new Map),ne.get(e).set(t,qe(e.children[t])),t}function Gt(e,t){if(!et(e,t))return null;const n=t.children;if(n.length===0)return{index:0,isProximityBased:!0};const i=zt(t);for(let a=0;a<n.length;a++)if(et(e,n[a])){const s=ne.has(t)&&ne.get(t).get(a);return s&&!Te(de(e),s)?{index:i,isProximityBased:!1}:{index:a,isProximityBased:!1}}let r=Number.MAX_VALUE,o;for(let a=0;a<n.length;a++){const s=Ft(e,n[a]);s<r&&(r=s,o=a)}return{index:o,isProximityBased:!0}}function $(e){return JSON.stringify(e,null,2)}function be(e){if(!e)throw new Error("cannot get depth of a falsy node");return tt(e,0)}function tt(e,t=0){return e.parentElement?tt(e.parentElement,t+1):t-1}function Bt(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!{}.hasOwnProperty.call(t,n)||t[n]!==e[n])return!1;return!0}function Zt(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}const Ht=200,nt=10;let $e;function Ut(e,t,n=Ht,i){let r,o,a=!1,s;const c=Array.from(t).sort((l,h)=>be(h)-be(l));function g(){const l=de(e),h=i.multiScrollIfNeeded();if(!h&&s&&Math.abs(s.x-l.x)<nt&&Math.abs(s.y-l.y)<nt){$e=window.setTimeout(g,n);return}if($t(e)){u(()=>"off document"),Nt(e);return}s=l;let d=!1;for(const f of c){h&&Fe();const E=Gt(e,f);if(E===null)continue;const{index:M}=E;d=!0,f!==r?(r&&Rt(r,e,f),It(f,E,e),r=f):M!==o&&(xt(f,E,e),o=M);break}!d&&a&&r?(St(r,e),r=void 0,o=void 0,a=!1):a=!0,$e=window.setTimeout(g,n)}g()}function Wt(){u(()=>"unobserving"),clearTimeout($e),Fe()}const le=30;function Yt(){let e;function t(){e={directionObj:void 0,stepPx:0}}t();function n(o){const{directionObj:a,stepPx:s}=e;a&&(o.scrollBy(a.x*s,a.y*s),window.requestAnimationFrame(()=>n(o)))}function i(o){return le-o}function r(o,a){if(!a)return!1;const s=Vt(o,a),c=!!e.directionObj;if(s===null)return c&&t(),!1;let[g,l]=[!1,!1];return a.scrollHeight>a.clientHeight&&(s.bottom<le?(g=!0,e.directionObj={x:0,y:1},e.stepPx=i(s.bottom)):s.top<le&&(g=!0,e.directionObj={x:0,y:-1},e.stepPx=i(s.top)),!c&&g)||a.scrollWidth>a.clientWidth&&(s.right<le?(l=!0,e.directionObj={x:1,y:0},e.stepPx=i(s.right)):s.left<le&&(l=!0,e.directionObj={x:-1,y:0},e.stepPx=i(s.left)),!c&&l)?(n(a),!0):(t(),!1)}return{scrollIfNeeded:r,resetScrolling:t}}function Vt(e,t){const n=t===document.scrollingElement?{top:0,bottom:window.innerHeight,left:0,right:window.innerWidth}:t.getBoundingClientRect();return Te(e,n)?{top:e.y-n.top,bottom:n.bottom-e.y,left:e.x-n.left,right:n.right-e.x}:null}function jt(e=[],t){u(()=>"creating multi-scroller");const n=Xt(e),i=Array.from(n).sort((s,c)=>be(c)-be(s)),{scrollIfNeeded:r,resetScrolling:o}=Yt();function a(){const s=t();if(!s||!i)return!1;const c=i.filter(g=>Te(s,g.getBoundingClientRect())||g===document.scrollingElement);for(let g=0;g<c.length;g++)if(r(s,c[g]))return!0;return!1}return{multiScrollIfNeeded:n.size>0?a:()=>!1,destroy:()=>o()}}function Kt(e){if(!e)return[];const t=[];let n=e;for(;n;){const{overflow:i}=window.getComputedStyle(n);i.split(" ").some(r=>r.includes("auto")||r.includes("scroll"))&&t.push(n),n=n.parentElement}return t}function Xt(e){const t=new Set;for(let n of e)Kt(n).forEach(i=>t.add(i));return(document.scrollingElement.scrollHeight>document.scrollingElement.clientHeight||document.scrollingElement.scrollWidth>document.scrollingElement.clientHeight)&&t.add(document.scrollingElement),t}function qt(e){const t=e.cloneNode(!0),n=[],i=e.tagName==="SELECT",r=i?[e]:[...e.querySelectorAll("select")];for(const s of r)n.push(s.value);if(r.length>0){const s=i?[t]:[...t.querySelectorAll("select")];for(let c=0;c<s.length;c++){const g=s[c],l=n[c],h=g.querySelector(`option[value="${l}"`);h&&h.setAttribute("selected",!0)}}const o=e.tagName==="CANVAS",a=o?[e]:[...e.querySelectorAll("canvas")];if(a.length>0){const s=o?[t]:[...t.querySelectorAll("canvas")];for(let c=0;c<s.length;c++){const g=a[c],l=s[c];l.width=g.width,l.height=g.height,g.width>0&&g.height>0&&l.getContext("2d").drawImage(g,0,0)}}return t}const V=Object.freeze({USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT:"USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT"}),it={[V.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT]:!1};function Jt(e,t){if(!V[e])throw new Error(`Can't set non existing feature flag ${e}! Supported flags: ${Object.keys(V)}`);it[e]=!!t}function rt(e){if(!V[e])throw new Error(`Can't get non existing feature flag ${e}! Supported flags: ${Object.keys(V)}`);return it[e]}const Qt=.2;function X(e){return`${e} ${Qt}s ease`}function en(e,t){const n=e.getBoundingClientRect(),i=qt(e);ot(e,i),i.id=Ve,i.style.position="fixed";let r=n.top,o=n.left;if(i.style.top=`${r}px`,i.style.left=`${o}px`,t){const a=Qe(n);r-=a.y-t.y,o-=a.x-t.x,window.setTimeout(()=>{i.style.top=`${r}px`,i.style.left=`${o}px`},0)}return i.style.margin="0",i.style.boxSizing="border-box",i.style.height=`${n.height}px`,i.style.width=`${n.width}px`,i.style.transition=`${X("top")}, ${X("left")}, ${X("background-color")}, ${X("opacity")}, ${X("color")} `,window.setTimeout(()=>i.style.transition+=`, ${X("width")}, ${X("height")}`,0),i.style.zIndex="9999",i.style.cursor="grabbing",i}function tn(e){e.style.cursor="grab"}function nn(e,t,n,i){ot(t,e);const r=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=r.width-o.width,s=r.height-o.height;if(a||s){const c={left:(n-o.left)/o.width,top:(i-o.top)/o.height};rt(V.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)||(e.style.height=`${r.height}px`,e.style.width=`${r.width}px`),e.style.left=`${parseFloat(e.style.left)-c.left*a}px`,e.style.top=`${parseFloat(e.style.top)-c.top*s}px`}}function ot(e,t){const n=window.getComputedStyle(e);Array.from(n).filter(i=>i.startsWith("background")||i.startsWith("padding")||i.startsWith("font")||i.startsWith("text")||i.startsWith("align")||i.startsWith("justify")||i.startsWith("display")||i.startsWith("flex")||i.startsWith("border")||i==="opacity"||i==="color"||i==="list-style-type"||rt(V.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)&&(i==="width"||i==="height")).forEach(i=>t.style.setProperty(i,n.getPropertyValue(i),n.getPropertyPriority(i)))}function rn(e,t){e.draggable=!1,e.ondragstart=()=>!1,t?(e.style.userSelect="",e.style.WebkitUserSelect="",e.style.cursor=""):(e.style.userSelect="none",e.style.WebkitUserSelect="none",e.style.cursor="grab")}function st(e){e.style.display="none",e.style.position="fixed",e.style.zIndex="-5"}function on(e){e.style.visibility="hidden",e.setAttribute(ye,"true")}function sn(e){e.style.visibility="",e.removeAttribute(ye)}function ve(e,t=()=>{},n=()=>[]){e.forEach(i=>{const r=t(i);Object.keys(r).forEach(o=>{i.style[o]=r[o]}),n(i).forEach(o=>i.classList.add(o))})}function _e(e,t=()=>{},n=()=>[]){e.forEach(i=>{const r=t(i);Object.keys(r).forEach(o=>{i.style[o]=""}),n(i).forEach(o=>i.classList.contains(o)&&i.classList.remove(o))})}function an(e){const t=e.style.minHeight;e.style.minHeight=window.getComputedStyle(e).getPropertyValue("height");const n=e.style.minWidth;return e.style.minWidth=window.getComputedStyle(e).getPropertyValue("width"),function(){e.style.minHeight=t,e.style.minWidth=n}}const dn="--any--",ln=100,cn=20,Ae=3,un=80,at={outline:"rgba(255, 255, 102, 0.7) solid 2px"},dt="data-is-dnd-original-dragged-item";let R,T,P,Oe,m,Ie,ie,b,Z,S,j=!1,ke=!1,ze,ce=!1,ue=[],fe,H,ge=!1;const k=new Map,D=new Map,Ge=new WeakMap;function fn(e,t){u(()=>"registering drop-zone if absent"),k.has(t)||k.set(t,new Set),k.get(t).has(e)||(k.get(t).add(e),Ke())}function lt(e,t){k.get(t).delete(e),Xe(),k.get(t).size===0&&k.delete(t)}function gn(){u(()=>"watching dragged element");const e=k.get(Oe);for(const i of e)i.addEventListener(me,ct),i.addEventListener(ae,ut),i.addEventListener(pe,ft);window.addEventListener(Me,re);const t=Math.max(...Array.from(e.keys()).map(i=>D.get(i).dropAnimationDurationMs)),n=t===0?cn:Math.max(t,ln);fe=jt(e,()=>S),Ut(T,e,n*1.07,fe)}function En(){u(()=>"unwatching dragged element");const e=k.get(Oe);for(const t of e)t.removeEventListener(me,ct),t.removeEventListener(ae,ut),t.removeEventListener(pe,ft);window.removeEventListener(Me,re),fe&&(fe.destroy(),fe=void 0),Wt()}function Re(e){return e.findIndex(t=>!!t[te])}function hn(e){return{...e,[te]:!0,[I]:Ye,[je]:e[I]}}function ct(e){u(()=>["dragged entered",e.currentTarget,e.detail]);let{items:t,dropFromOthersDisabled:n}=D.get(e.currentTarget);if(n&&e.currentTarget!==m){u(()=>"ignoring dragged entered because drop is currently disabled");return}if(ce=!1,t=t.filter(a=>!a[te]),u(()=>`dragged entered items ${$(t)}`),m!==e.currentTarget){const s=D.get(m).items.filter(c=>!c[te]);Y(m,s,{trigger:v.DRAGGED_ENTERED_ANOTHER,id:P[I],source:_.POINTER})}const{index:i,isProximityBased:r}=e.detail.indexObj,o=r&&i===e.currentTarget.children.length-1?i+1:i;b=e.currentTarget,t.splice(o,0,ie),Y(e.currentTarget,t,{trigger:v.DRAGGED_ENTERED,id:P[I],source:_.POINTER})}function ut(e){if(!j)return;u(()=>["dragged left",e.currentTarget,e.detail]);const{items:t,dropFromOthersDisabled:n}=D.get(e.currentTarget);if(n&&e.currentTarget!==m&&e.currentTarget!==b){u(()=>"drop is currently disabled");return}const i=[...t],r=Re(i);r!==-1&&i.splice(r,1);const o=b;b=void 0;const{type:a,theOtherDz:s}=e.detail;if(a===De.OUTSIDE_OF_ANY||a===De.LEFT_FOR_ANOTHER&&s!==m&&D.get(s).dropFromOthersDisabled){u(()=>"dragged left all, putting shadow element back in the origin dz"),ce=!0,b=m;const c=o===m?i:[...D.get(m).items];c.splice(Ie,0,ie),Y(m,c,{trigger:v.DRAGGED_LEFT_ALL,id:P[I],source:_.POINTER})}Y(e.currentTarget,i,{trigger:v.DRAGGED_LEFT,id:P[I],source:_.POINTER})}function ft(e){u(()=>["dragged is over index",e.currentTarget,e.detail]);const{items:t,dropFromOthersDisabled:n}=D.get(e.currentTarget);if(n&&e.currentTarget!==m){u(()=>"drop is currently disabled");return}const i=[...t];ce=!1;const{index:r}=e.detail.indexObj,o=Re(i);o!==-1&&i.splice(o,1),i.splice(r,0,ie),Y(e.currentTarget,i,{trigger:v.DRAGGED_OVER_INDEX,id:P[I],source:_.POINTER})}function Se(e){e.preventDefault();const t=e.touches?e.touches[0]:e;S={x:t.clientX,y:t.clientY},T.style.transform=`translate3d(${S.x-Z.x}px, ${S.y-Z.y}px, 0)`}function re(){u(()=>"dropped"),ke=!0,window.removeEventListener("mousemove",Se),window.removeEventListener("touchmove",Se),window.removeEventListener("mouseup",re),window.removeEventListener("touchend",re),En(),tn(T),b||(u(()=>"element was dropped right after it left origin but before entering somewhere else"),b=m),u(()=>["dropped in dz",b]);let{items:e,type:t}=D.get(b);_e(k.get(t),r=>D.get(r).dropTargetStyle,r=>D.get(r).dropTargetClasses);let n=Re(e);n===-1&&b===m&&(n=Ie),e=e.map(r=>r[te]?P:r);function i(){ze(),ee(b,e,{trigger:ce?v.DROPPED_OUTSIDE_OF_ANY:v.DROPPED_INTO_ZONE,id:P[I],source:_.POINTER}),b!==m&&ee(m,D.get(m).items,{trigger:v.DROPPED_INTO_ANOTHER,id:P[I],source:_.POINTER});const r=Array.from(b.children).find(o=>o.getAttribute(ye));r&&sn(r),Dn()}D.get(b).dropAnimationDisabled?i():mn(n,i)}function mn(e,t){const n=e>-1?Pe(b.children[e],!1):Pe(b,!1),i={x:n.left-parseFloat(T.style.left),y:n.top-parseFloat(T.style.top)},{dropAnimationDurationMs:r}=D.get(b),o=`transform ${r}ms ease`;T.style.transition=T.style.transition?T.style.transition+","+o:o,T.style.transform=`translate3d(${i.x}px, ${i.y}px, 0)`,window.setTimeout(t,r)}function pn(e,t){ue.push({dz:e,destroy:t}),window.requestAnimationFrame(()=>{st(e),document.body.appendChild(e)})}function Dn(){T&&T.remove&&T.remove(),R&&R.remove&&R.remove(),T=void 0,R=void 0,P=void 0,Oe=void 0,m=void 0,Ie=void 0,ie=void 0,b=void 0,Z=void 0,S=void 0,j=!1,ke=!1,ze=void 0,ce=!1,H&&clearTimeout(H),H=void 0,ge=!1,ue.length&&(u(()=>["will destroy zones that were removed during drag",ue]),ue.forEach(({dz:e,destroy:t})=>{t(),e.remove()}),ue=[])}function yn(e,t){let n=!1;const i={items:void 0,type:void 0,flipDurationMs:0,dragDisabled:!1,morphDisabled:!1,dropFromOthersDisabled:!1,dropTargetStyle:at,dropTargetClasses:[],transformDraggedElement:()=>{},centreDraggedOnCursor:!1,dropAnimationDisabled:!1,delayTouchStartMs:0};u(()=>[`dndzone good to go options: ${$(t)}, config: ${$(i)}`,{node:e}]);let r=new Map;function o(){window.addEventListener("mousemove",c,{passive:!1}),window.addEventListener("touchmove",c,{passive:!1,capture:!1}),window.addEventListener("mouseup",s,{passive:!1}),window.addEventListener("touchend",s,{passive:!1})}function a(){window.removeEventListener("mousemove",c),window.removeEventListener("touchmove",c),window.removeEventListener("mouseup",s),window.removeEventListener("touchend",s),H&&(clearTimeout(H),H=void 0,ge=!1)}function s(d){if(a(),R=void 0,Z=void 0,S=void 0,d.type==="touchend"){const f=new Event("click",{bubbles:!0,cancelable:!0});d.target.dispatchEvent(f)}}function c(d){const f=!!d.touches,E=f?d.touches[0]:d;if(f&&i.delayTouchStartMs>0&&!ge){S={x:E.clientX,y:E.clientY},(Math.abs(S.x-Z.x)>=Ae||Math.abs(S.y-Z.y)>=Ae)&&(H&&(clearTimeout(H),H=void 0),s(d));return}d.preventDefault(),S={x:E.clientX,y:E.clientY},(Math.abs(S.x-Z.x)>=Ae||Math.abs(S.y-Z.y)>=Ae)&&(a(),l())}function g(d){if(d.target!==d.currentTarget&&(d.target.value!==void 0||d.target.isContentEditable)){u(()=>"won't initiate drag on a nested input element");return}if(d.button){u(()=>`ignoring none left click button: ${d.button}`);return}if(j){u(()=>"cannot start a new drag before finalizing previous one");return}const f=!!d.touches,E=f&&i.delayTouchStartMs>0;E||d.preventDefault(),d.stopPropagation();const M=f?d.touches[0]:d;Z={x:M.clientX,y:M.clientY},S={...Z},R=d.currentTarget,E&&(ge=!1,H=window.setTimeout(()=>{R&&(ge=!0,a(),l())},i.delayTouchStartMs)),o()}function l(){u(()=>[`drag start config: ${$(i)}`,R]),j=!0;const d=r.get(R);Ie=d,m=R.parentElement;const f=m.closest("dialog")||m.closest("[popover]")||m.getRootNode(),E=f.body||f,{items:M,type:W,centreDraggedOnCursor:U}=i,N=[...M];P=N[d],Oe=W,ie=hn(P),T=en(R,U&&S),E.appendChild(T);function L(){if(!R){u(()=>"originalDragTarget became undefined, aborting keepOriginalElementInDom");return}R.parentElement?window.requestAnimationFrame(L):(R.setAttribute(dt,!0),E.appendChild(R),gn(),st(R),T.focus())}window.requestAnimationFrame(L),ve(Array.from(k.get(i.type)).filter(p=>p===m||!D.get(p).dropFromOthersDisabled),p=>D.get(p).dropTargetStyle,p=>D.get(p).dropTargetClasses),N.splice(d,1,ie),ze=an(m),Y(m,N,{trigger:v.DRAG_STARTED,id:P[I],source:_.POINTER}),window.addEventListener("mousemove",Se,{passive:!1}),window.addEventListener("touchmove",Se,{passive:!1,capture:!1}),window.addEventListener("mouseup",re,{passive:!1}),window.addEventListener("touchend",re,{passive:!1})}function h({items:d=void 0,flipDurationMs:f=0,type:E=dn,dragDisabled:M=!1,morphDisabled:W=!1,dropFromOthersDisabled:U=!1,dropTargetStyle:N=at,dropTargetClasses:L=[],transformDraggedElement:p=()=>{},centreDraggedOnCursor:Nn=!1,dropAnimationDisabled:Ln=!1,delayTouchStart:he=!1}){i.dropAnimationDurationMs=f;let We=0;he===!0?We=un:typeof he=="number"&&isFinite(he)&&he>=0&&(We=he),i.delayTouchStartMs=We,i.type&&E!==i.type&&lt(e,i.type),i.type=E,i.items=[...d],i.dragDisabled=M,i.morphDisabled=W,i.transformDraggedElement=p,i.centreDraggedOnCursor=Nn,i.dropAnimationDisabled=Ln,n&&j&&!ke&&(!Bt(N,i.dropTargetStyle)||!Zt(L,i.dropTargetClasses))&&(_e([e],()=>i.dropTargetStyle,()=>L),ve([e],()=>N,()=>L)),i.dropTargetStyle=N,i.dropTargetClasses=[...L];function Le(O,C){return D.get(O)?D.get(O)[C]:i[C]}n&&j&&i.dropFromOthersDisabled!==U&&(U?_e([e],O=>Le(O,"dropTargetStyle"),O=>Le(O,"dropTargetClasses")):ve([e],O=>Le(O,"dropTargetStyle"),O=>Le(O,"dropTargetClasses"))),i.dropFromOthersDisabled=U,D.set(e,i),fn(e,E);const Mn=j?Re(i.items):-1;for(let O=0;O<e.children.length;O++){const C=e.children[O];if(rn(C,M),O===Mn){W||nn(T,C,S.x,S.y),i.transformDraggedElement(T,P,O),on(C);continue}C.removeEventListener("mousedown",Ge.get(C)),C.removeEventListener("touchstart",Ge.get(C)),M||(C.addEventListener("mousedown",g),C.addEventListener("touchstart",g),Ge.set(C,g)),r.set(C,O),n||(n=!0)}}return h(t),{update:d=>{u(()=>`pointer dndzone will update newOptions: ${$(d)}`),h(d)},destroy:()=>{function d(){u(()=>"pointer dndzone will destroy"),lt(e,D.get(e).type),D.delete(e)}j&&!e.closest(`[${dt}]`)?(u(()=>"pointer dndzone will be scheduled for destruction"),pn(e,d)):d()}}}const Be={DND_ZONE_ACTIVE:"dnd-zone-active",DND_ZONE_DRAG_DISABLED:"dnd-zone-drag-disabled"},gt={[Be.DND_ZONE_ACTIVE]:"Tab to one the items and press space-bar or enter to start dragging it",[Be.DND_ZONE_DRAG_DISABLED]:"This is a disabled drag and drop list"},wn="dnd-action-aria-alert";let y;function Ze(){y||(y=document.createElement("div"),function(){y.id=wn,y.style.position="fixed",y.style.bottom="0",y.style.left="0",y.style.zIndex="-5",y.style.opacity="0",y.style.height="0",y.style.width="0",y.setAttribute("role","alert")}(),document.body.prepend(y),Object.entries(gt).forEach(([e,t])=>document.body.prepend(vn(e,t))))}function Tn(){return Ce?null:(document.readyState==="complete"?Ze():window.addEventListener("DOMContentLoaded",Ze),{...Be})}function bn(){Ce||!y||(Object.keys(gt).forEach(e=>document.getElementById(e)?.remove()),y.remove(),y=void 0)}function vn(e,t){const n=document.createElement("div");return n.id=e,n.innerHTML=`<p>${t}</p>`,n.style.display="none",n.style.position="fixed",n.style.zIndex="-5",n}function q(e){if(Ce)return;y||Ze(),y.innerHTML="";const t=document.createTextNode(e);y.appendChild(t),y.style.display="none",y.style.display="inline"}const _n="--any--",Et={outline:"rgba(255, 255, 102, 0.7) solid 2px"};let F=!1,He,x,J="",Q,z,K="";const xe=new WeakSet,ht=new WeakMap,mt=new WeakMap,Ue=new Map,A=new Map,G=new Map;let Ne;function An(e,t){u(()=>"registering drop-zone if absent"),G.size===0&&(u(()=>"adding global keydown and click handlers"),Ne=Tn(),window.addEventListener("keydown",Dt),window.addEventListener("click",yt)),G.has(t)||G.set(t,new Set),G.get(t).has(e)||(G.get(t).add(e),Ke())}function pt(e,t){u(()=>"unregistering drop-zone"),x===e&&Ee(),G.get(t).delete(e),Xe(),G.get(t).size===0&&G.delete(t),G.size===0&&(u(()=>"removing global keydown and click handlers"),window.removeEventListener("keydown",Dt),window.removeEventListener("click",yt),Ne=void 0,bn())}function Dt(e){if(F)switch(e.key){case"Escape":{Ee();break}}}function yt(){F&&(xe.has(document.activeElement)||(u(()=>"clicked outside of any draggable"),Ee()))}function On(e){if(u(()=>"zone focus"),!F)return;const t=e.currentTarget;if(t===x)return;J=t.getAttribute("aria-label")||"";const{items:n}=A.get(x),i=n.find(g=>g[I]===z),r=n.indexOf(i),o=n.splice(r,1)[0],{items:a,autoAriaDisabled:s}=A.get(t);t.getBoundingClientRect().top<x.getBoundingClientRect().top||t.getBoundingClientRect().left<x.getBoundingClientRect().left?(a.push(o),s||q(`Moved item ${K} to the end of the list ${J}`)):(a.unshift(o),s||q(`Moved item ${K} to the beginning of the list ${J}`)),ee(x,n,{trigger:v.DROPPED_INTO_ANOTHER,id:z,source:_.KEYBOARD}),ee(t,a,{trigger:v.DROPPED_INTO_ZONE,id:z,source:_.KEYBOARD}),x=t}function wt(){Ue.forEach(({update:e},t)=>e(A.get(t)))}function Ee(e=!0){u(()=>"drop"),A.get(x).autoAriaDisabled||q(`Stopped dragging item ${K}`),xe.has(document.activeElement)&&document.activeElement.blur(),e&&Y(x,A.get(x).items,{trigger:v.DRAG_STOPPED,id:z,source:_.KEYBOARD}),_e(G.get(He),t=>A.get(t).dropTargetStyle,t=>A.get(t).dropTargetClasses),Q=null,z=null,K="",He=null,x=null,J="",F=!1,wt()}function In(e,t){const n={items:void 0,type:void 0,dragDisabled:!1,zoneTabIndex:0,zoneItemTabIndex:0,dropFromOthersDisabled:!1,dropTargetStyle:Et,dropTargetClasses:[],autoAriaDisabled:!1};function i(l,h,d){l.length<=1||l.splice(d,1,l.splice(h,1,l[d])[0])}function r(l){switch(u(()=>["handling key down",l.key]),l.key){case"Enter":case" ":{if((l.target.disabled!==void 0||l.target.href||l.target.isContentEditable)&&!xe.has(l.target))return;l.preventDefault(),l.stopPropagation(),F?Ee():o(l);break}case"ArrowDown":case"ArrowRight":{if(!F)return;l.preventDefault(),l.stopPropagation();const{items:h}=A.get(e),d=Array.from(e.children),f=d.indexOf(l.currentTarget);u(()=>["arrow down",f]),f<d.length-1&&(n.autoAriaDisabled||q(`Moved item ${K} to position ${f+2} in the list ${J}`),i(h,f,f+1),ee(e,h,{trigger:v.DROPPED_INTO_ZONE,id:z,source:_.KEYBOARD}));break}case"ArrowUp":case"ArrowLeft":{if(!F)return;l.preventDefault(),l.stopPropagation();const{items:h}=A.get(e),f=Array.from(e.children).indexOf(l.currentTarget);u(()=>["arrow up",f]),f>0&&(n.autoAriaDisabled||q(`Moved item ${K} to position ${f} in the list ${J}`),i(h,f,f-1),ee(e,h,{trigger:v.DROPPED_INTO_ZONE,id:z,source:_.KEYBOARD}));break}}}function o(l){u(()=>"drag start"),s(l.currentTarget),x=e,He=n.type,F=!0;const h=Array.from(G.get(n.type)).filter(d=>d===x||!A.get(d).dropFromOthersDisabled);if(ve(h,d=>A.get(d).dropTargetStyle,d=>A.get(d).dropTargetClasses),!n.autoAriaDisabled){let d=`Started dragging item ${K}. Use the arrow keys to move it within its list ${J}`;h.length>1&&(d+=", or tab to another list in order to move the item into it"),q(d)}Y(e,A.get(e).items,{trigger:v.DRAG_STARTED,id:z,source:_.KEYBOARD}),wt()}function a(l){F&&l.currentTarget!==Q&&(l.stopPropagation(),Ee(!1),o(l))}function s(l){const{items:h}=A.get(e),d=Array.from(e.children),f=d.indexOf(l);Q=l,Q.tabIndex=n.zoneItemTabIndex,z=h[f][I],K=d[f].getAttribute("aria-label")||""}function c({items:l=[],type:h=_n,dragDisabled:d=!1,zoneTabIndex:f=0,zoneItemTabIndex:E=0,dropFromOthersDisabled:M=!1,dropTargetStyle:W=Et,dropTargetClasses:U=[],autoAriaDisabled:N=!1}){n.items=[...l],n.dragDisabled=d,n.dropFromOthersDisabled=M,n.zoneTabIndex=f,n.zoneItemTabIndex=E,n.dropTargetStyle=W,n.dropTargetClasses=U,n.autoAriaDisabled=N,n.type&&h!==n.type&&pt(e,n.type),n.type=h,An(e,h),N||(e.setAttribute("aria-disabled",d),e.setAttribute("role","list"),e.setAttribute("aria-describedby",d?Ne.DND_ZONE_DRAG_DISABLED:Ne.DND_ZONE_ACTIVE)),A.set(e,n),F?e.tabIndex=e===x||Q.contains(e)||n.dropFromOthersDisabled||x&&n.type!==A.get(x).type?-1:0:e.tabIndex=n.zoneTabIndex,e.addEventListener("focus",On);for(let L=0;L<e.children.length;L++){const p=e.children[L];xe.add(p),p.tabIndex=F?-1:n.zoneItemTabIndex,N||p.setAttribute("role","listitem"),p.removeEventListener("keydown",ht.get(p)),p.removeEventListener("click",mt.get(p)),d||(p.addEventListener("keydown",r),ht.set(p,r),p.addEventListener("click",a),mt.set(p,a)),F&&n.items[L][I]===z&&(u(()=>["focusing on",{i:L,focusedItemId:z}]),Q=p,Q.tabIndex=n.zoneItemTabIndex,p.focus())}}c(t);const g={update:l=>{u(()=>`keyboard dndzone will update newOptions: ${$(l)}`),c(l)},destroy:()=>{u(()=>"keyboard dndzone will destroy"),pt(e,n.type),A.delete(e),Ue.delete(e)}};return Ue.set(e,g),g}function Tt(e,t){if(Rn(e))return{update:()=>{},destroy:()=>{}};bt(t);const n=yn(e,t),i=In(e,t);return{update:r=>{bt(r),n.update(r),i.update(r)},destroy:()=>{n.destroy(),i.destroy()}}}function Rn(e){return!!e.closest(`[${Lt}="true"]`)}function bt(e){const{items:t,flipDurationMs:n,type:i,dragDisabled:r,morphDisabled:o,dropFromOthersDisabled:a,zoneTabIndex:s,zoneItemTabIndex:c,dropTargetStyle:g,dropTargetClasses:l,transformDraggedElement:h,autoAriaDisabled:d,centreDraggedOnCursor:f,delayTouchStart:E,dropAnimationDisabled:M,...W}=e;if(Object.keys(W).length>0&&console.warn("dndzone will ignore unknown options",W),!t)throw new Error("no 'items' key provided to dndzone");const U=t.find(N=>!{}.hasOwnProperty.call(N,I));if(U)throw new Error(`missing '${I}' property for item ${$(U)}`);if(l&&!Array.isArray(l))throw new Error(`dropTargetClasses should be an array but instead it is a ${typeof l}, ${$(l)}`);if(s&&!vt(s))throw new Error(`zoneTabIndex should be a number but instead it is a ${typeof s}, ${$(s)}`);if(c&&!vt(c))throw new Error(`zoneItemTabIndex should be a number but instead it is a ${typeof c}, ${$(c)}`);if(E!==void 0&&E!==!1){const N=E===!0,L=typeof E=="number"&&isFinite(E)&&E>=0;if(!N&&!L)throw new Error(`delayTouchStart should be a boolean (true/false) or a non-negative number but instead it is a ${typeof E}, ${$(E)}`)}}function vt(e){return!isNaN(e)&&function(t){return(t|0)===t}(parseFloat(e))}function _t(e){let t=e;const n=new Set;return{get:()=>t,set:i=>{t=i,Array.from(n).forEach(r=>r(t))},subscribe:i=>{n.add(i),i(t)},unsubscribe:i=>{n.delete(i)}}}const B=_t(!0),oe=_t(!1);function At(){return{dragDisabled:oe.get()||B.get(),zoneItemTabIndex:-1}}function Sn(e,t){oe.set(t?.dragDisabled??!1);let n=t;const i=Tt(e,{...n,...At()});function r(){i.update({...n,...At()})}B.subscribe(r);function o(s){const{info:{source:c,trigger:g}}=s.detail;c===_.KEYBOARD&&g===v.DRAG_STOPPED&&B.set(!0)}function a(s){const{info:{source:c}}=s.detail;c===_.POINTER&&B.set(!0)}return e.addEventListener("consider",o),e.addEventListener("finalize",a),{update:s=>{n=s,oe.set(n?.dragDisabled??!1),r()},destroy:()=>{e.removeEventListener("consider",o),e.removeEventListener("finalize",a),B.unsubscribe(r)}}}function xn(e){e.setAttribute("role","button");function t(o){o.preventDefault(),B.set(!1),window.addEventListener("mouseup",i),window.addEventListener("touchend",i)}function n(o){(o.key==="Enter"||o.key===" ")&&B.set(!1)}function i(){B.set(!0),window.removeEventListener("mouseup",i),window.removeEventListener("touchend",i)}const r=()=>{const o=oe.get(),a=B.get();o?(e.tabIndex=-1,e.style.cursor=""):(e.tabIndex=a?0:-1,e.style.cursor=a?"grab":"grabbing")};return oe.subscribe(r),B.subscribe(r),e.addEventListener("mousedown",t),e.addEventListener("touchstart",t),e.addEventListener("keydown",n),{update:()=>{},destroy:()=>{e.removeEventListener("mousedown",t),e.removeEventListener("touchstart",t),e.removeEventListener("keydown",n),oe.unsubscribe(r),B.unsubscribe(r)}}}w.DND_PERMANENT_ID_KEY=je,w.DRAGGED_ELEMENT_ID=Ve,w.FEATURE_FLAG_NAMES=V,w.SHADOW_ITEM_MARKER_PROPERTY_NAME=te,w.SHADOW_PLACEHOLDER_ITEM_ID=Ye,w.SOURCES=_,w.TRIGGERS=v,w.alertToScreenReader=q,w.dndzone=Tt,w.dragHandle=xn,w.dragHandleZone=Sn,w.overrideItemIdKeyNameBeforeInitialisingDndZones=Mt,w.setDebugMode=Ct,w.setFeatureFlag=Jt,Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.js.map
