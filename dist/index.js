(function(y,se){typeof exports=="object"&&typeof module<"u"?se(exports):typeof define=="function"&&define.amd?define(["exports"],se):(y=typeof globalThis<"u"?globalThis:y||self,se(y.SvelteDndAction={}))})(this,function(y){"use strict";const se="finalize",Ot="consider";function ee(e,t,n){e.dispatchEvent(new CustomEvent(se,{detail:{items:t,info:n}}))}function Y(e,t,n){e.dispatchEvent(new CustomEvent(Ot,{detail:{items:t,info:n}}))}const me="draggedEntered",ae="draggedLeft",pe="draggedOverIndex",Ce="draggedLeftDocument",De={LEFT_FOR_ANOTHER:"leftForAnother",OUTSIDE_OF_ANY:"outsideOfAny"};function It(e,t,n){e.dispatchEvent(new CustomEvent(me,{detail:{indexObj:t,draggedEl:n}}))}function Rt(e,t,n){e.dispatchEvent(new CustomEvent(ae,{detail:{draggedEl:t,type:De.LEFT_FOR_ANOTHER,theOtherDz:n}}))}function St(e,t){e.dispatchEvent(new CustomEvent(ae,{detail:{draggedEl:t,type:De.OUTSIDE_OF_ANY}}))}function xt(e,t,n){e.dispatchEvent(new CustomEvent(pe,{detail:{indexObj:t,draggedEl:n}}))}function Nt(e){window.dispatchEvent(new CustomEvent(Ce,{detail:{draggedEl:e}}))}const v={DRAG_STARTED:"dragStarted",DRAGGED_ENTERED:me,DRAGGED_ENTERED_ANOTHER:"dragEnteredAnother",DRAGGED_OVER_INDEX:pe,DRAGGED_LEFT:ae,DRAGGED_LEFT_ALL:"draggedLeftAll",DROPPED_INTO_ZONE:"droppedIntoZone",DROPPED_INTO_ANOTHER:"droppedIntoAnother",DROPPED_OUTSIDE_OF_ANY:"droppedOutsideOfAny",DRAG_STOPPED:"dragStopped"},A={POINTER:"pointer",KEYBOARD:"keyboard"},te="isDndShadowItem",ye="data-is-dnd-shadow-item-internal",Lt="data-is-dnd-shadow-item-hint",Ve="id:dnd-shadow-placeholder-0000",je="dnd-action-dragged-el",we="dndShadowBackupId";let _="id",Te=0;function Ke(){Te++}function Xe(){if(Te===0)throw new Error("Bug! trying to decrement when there are no dropzones");Te--}function Mt(e){if(Te>0)throw new Error("can only override the id key before initialising any dndzone");if(typeof e!="string")throw new Error("item id key has to be a string");u(()=>["overriding item id key name",e]),_=e}function Ct(e){return e[we]?e[we]:e[_]}const Pe=typeof window>"u";let u=()=>{};function Pt(e){e?u=(t,n=console.debug)=>{const r=t();Array.isArray(r)?n(...r):n(r)}:u=()=>{}}function Fe(e,t=!0){let n;const r=t?zt(e):e.getBoundingClientRect(),i=getComputedStyle(e),o=i.transform;if(o){let a,s,c,g;if(o.startsWith("matrix3d("))n=o.slice(9,-1).split(/, /),a=+n[0],s=+n[5],c=+n[12],g=+n[13];else if(o.startsWith("matrix("))n=o.slice(7,-1).split(/, /),a=+n[0],s=+n[3],c=+n[4],g=+n[5];else return r;const l=i.transformOrigin,E=r.x-c-(1-a)*parseFloat(l),d=r.y-g-(1-s)*parseFloat(l.slice(l.indexOf(" ")+1)),f=a?r.width/a:e.offsetWidth,h=s?r.height/s:e.offsetHeight;return{x:E,y:d,width:f,height:h,top:d,right:E+f,bottom:d+h,left:E}}else return r}function qe(e){const t=Fe(e);return{top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX}}function Je(e){const t=e.getBoundingClientRect();return{top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX}}function Qe(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}function Ft(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function be(e,t){return e.y<=t.bottom&&e.y>=t.top&&e.x>=t.left&&e.x<=t.right}function de(e){return Qe(Je(e))}function et(e,t){const n=de(e),r=qe(t);return be(n,r)}function $t(e,t){const n=de(e),r=de(t);return Ft(n,r)}function kt(e){const t=Je(e);return t.right<0||t.left>document.documentElement.scrollWidth||t.bottom<0||t.top>document.documentElement.scrollHeight}function zt(e){let t=e.getBoundingClientRect(),n={top:t.top,bottom:t.bottom,left:t.left,right:t.right},r=e.parentElement;for(;r&&r!==document.body;){let i=r.getBoundingClientRect();const o=window.getComputedStyle(r).overflowY,a=window.getComputedStyle(r).overflowX,s=o==="scroll"||o==="auto",c=a==="scroll"||a==="auto";s&&(n.top=Math.max(n.top,i.top),n.bottom=Math.min(n.bottom,i.bottom)),c&&(n.left=Math.max(n.left,i.left),n.right=Math.min(n.right,i.right)),r=r.parentElement}return n.top=Math.max(n.top,0),n.bottom=Math.min(n.bottom,window.innerHeight),n.left=Math.max(n.left,0),n.right=Math.min(n.right,window.innerWidth),{top:n.top,bottom:n.bottom,left:n.left,right:n.right,width:Math.max(0,n.right-n.left),height:Math.max(0,n.bottom-n.top)}}let ne;function $e(){u(()=>"resetting indexes cache"),ne=new Map}$e();function Gt(e){const t=Array.from(e.children).findIndex(n=>n.getAttribute(ye));if(t>=0)return ne.has(e)||ne.set(e,new Map),ne.get(e).set(t,qe(e.children[t])),t}function Bt(e,t){if(!et(e,t))return null;const n=t.children;if(n.length===0)return{index:0,isProximityBased:!0};const r=Gt(t);for(let a=0;a<n.length;a++)if(et(e,n[a])){const s=ne.has(t)&&ne.get(t).get(a);return s&&!be(de(e),s)?{index:r,isProximityBased:!1}:{index:a,isProximityBased:!1}}let i=Number.MAX_VALUE,o;for(let a=0;a<n.length;a++){const s=$t(e,n[a]);s<i&&(i=s,o=a)}return{index:o,isProximityBased:!0}}function $(e){return JSON.stringify(e,null,2)}function ve(e){if(!e)throw new Error("cannot get depth of a falsy node");return tt(e,0)}function tt(e,t=0){return e.parentElement?tt(e.parentElement,t+1):t-1}function Zt(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!{}.hasOwnProperty.call(t,n)||t[n]!==e[n])return!1;return!0}function Ht(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}const Ut=200,nt=10;let ke;function Wt(e,t,n=Ut,r){let i,o,a=!1,s;const c=Array.from(t).sort((l,E)=>ve(E)-ve(l));function g(){const l=de(e),E=r.multiScrollIfNeeded();if(!E&&s&&Math.abs(s.x-l.x)<nt&&Math.abs(s.y-l.y)<nt){ke=window.setTimeout(g,n);return}if(kt(e)){u(()=>"off document"),Nt(e);return}s=l;let d=!1;for(const f of c){E&&$e();const h=Bt(e,f);if(h===null)continue;const{index:M}=h;d=!0,f!==i?(i&&Rt(i,e,f),It(f,h,e),i=f):M!==o&&(xt(f,h,e),o=M);break}!d&&a&&i?(St(i,e),i=void 0,o=void 0,a=!1):a=!0,ke=window.setTimeout(g,n)}g()}function Yt(){u(()=>"unobserving"),clearTimeout(ke),$e()}const le=30;function Vt(){let e;function t(){e={directionObj:void 0,stepPx:0}}t();function n(o){const{directionObj:a,stepPx:s}=e;a&&(o.scrollBy(a.x*s,a.y*s),window.requestAnimationFrame(()=>n(o)))}function r(o){return le-o}function i(o,a){if(!a)return!1;const s=jt(o,a),c=!!e.directionObj;if(s===null)return c&&t(),!1;let[g,l]=[!1,!1];return a.scrollHeight>a.clientHeight&&(s.bottom<le?(g=!0,e.directionObj={x:0,y:1},e.stepPx=r(s.bottom)):s.top<le&&(g=!0,e.directionObj={x:0,y:-1},e.stepPx=r(s.top)),!c&&g)||a.scrollWidth>a.clientWidth&&(s.right<le?(l=!0,e.directionObj={x:1,y:0},e.stepPx=r(s.right)):s.left<le&&(l=!0,e.directionObj={x:-1,y:0},e.stepPx=r(s.left)),!c&&l)?(n(a),!0):(t(),!1)}return{scrollIfNeeded:i,resetScrolling:t}}function jt(e,t){const n=t===document.scrollingElement?{top:0,bottom:window.innerHeight,left:0,right:window.innerWidth}:t.getBoundingClientRect();return be(e,n)?{top:e.y-n.top,bottom:n.bottom-e.y,left:e.x-n.left,right:n.right-e.x}:null}function Kt(e=[],t){u(()=>"creating multi-scroller");const n=qt(e),r=Array.from(n).sort((s,c)=>ve(c)-ve(s)),{scrollIfNeeded:i,resetScrolling:o}=Vt();function a(){const s=t();if(!s||!r)return!1;const c=r.filter(g=>be(s,g.getBoundingClientRect())||g===document.scrollingElement);for(let g=0;g<c.length;g++)if(i(s,c[g]))return!0;return!1}return{multiScrollIfNeeded:n.size>0?a:()=>!1,destroy:()=>o()}}function Xt(e){if(!e)return[];const t=[];let n=e;for(;n;){const{overflow:r}=window.getComputedStyle(n);r.split(" ").some(i=>i.includes("auto")||i.includes("scroll"))&&t.push(n),n=n.parentElement}return t}function qt(e){const t=new Set;for(let n of e)Xt(n).forEach(r=>t.add(r));return(document.scrollingElement.scrollHeight>document.scrollingElement.clientHeight||document.scrollingElement.scrollWidth>document.scrollingElement.clientHeight)&&t.add(document.scrollingElement),t}function Jt(e){const t=e.cloneNode(!0),n=[],r=e.tagName==="SELECT",i=r?[e]:[...e.querySelectorAll("select")];for(const s of i)n.push(s.value);if(i.length>0){const s=r?[t]:[...t.querySelectorAll("select")];for(let c=0;c<s.length;c++){const g=s[c],l=n[c],E=g.querySelector(`option[value="${l}"`);E&&E.setAttribute("selected",!0)}}const o=e.tagName==="CANVAS",a=o?[e]:[...e.querySelectorAll("canvas")];if(a.length>0){const s=o?[t]:[...t.querySelectorAll("canvas")];for(let c=0;c<s.length;c++){const g=a[c],l=s[c];l.width=g.width,l.height=g.height,g.width>0&&g.height>0&&l.getContext("2d").drawImage(g,0,0)}}return t}const V=Object.freeze({USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT:"USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT"}),rt={[V.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT]:!1};function Qt(e,t){if(!V[e])throw new Error(`Can't set non existing feature flag ${e}! Supported flags: ${Object.keys(V)}`);rt[e]=!!t}function it(e){if(!V[e])throw new Error(`Can't get non existing feature flag ${e}! Supported flags: ${Object.keys(V)}`);return rt[e]}const en=.2;function X(e){return`${e} ${en}s ease`}function tn(e,t){const n=e.getBoundingClientRect(),r=Jt(e);ot(e,r),r.id=je,r.style.position="fixed";let i=n.top,o=n.left;if(r.style.top=`${i}px`,r.style.left=`${o}px`,t){const a=Qe(n);i-=a.y-t.y,o-=a.x-t.x,window.setTimeout(()=>{r.style.top=`${i}px`,r.style.left=`${o}px`},0)}return r.style.margin="0",r.style.boxSizing="border-box",r.style.height=`${n.height}px`,r.style.width=`${n.width}px`,r.style.transition=`${X("top")}, ${X("left")}, ${X("background-color")}, ${X("opacity")}, ${X("color")} `,window.setTimeout(()=>r.style.transition+=`, ${X("width")}, ${X("height")}`,0),r.style.zIndex="9999",r.style.cursor="grabbing",r}function nn(e){e.style.cursor="grab"}function rn(e,t,n,r){ot(t,e);const i=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=i.width-o.width,s=i.height-o.height;if(a||s){const c={left:(n-o.left)/o.width,top:(r-o.top)/o.height};it(V.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)||(e.style.height=`${i.height}px`,e.style.width=`${i.width}px`),e.style.left=`${parseFloat(e.style.left)-c.left*a}px`,e.style.top=`${parseFloat(e.style.top)-c.top*s}px`}}function ot(e,t){const n=window.getComputedStyle(e);Array.from(n).filter(r=>r.startsWith("background")||r.startsWith("padding")||r.startsWith("font")||r.startsWith("text")||r.startsWith("align")||r.startsWith("justify")||r.startsWith("display")||r.startsWith("flex")||r.startsWith("border")||r==="opacity"||r==="color"||r==="list-style-type"||it(V.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)&&(r==="width"||r==="height")).forEach(r=>t.style.setProperty(r,n.getPropertyValue(r),n.getPropertyPriority(r)))}function on(e,t){e.draggable=!1,e.ondragstart=()=>!1,t?(e.style.userSelect="",e.style.WebkitUserSelect="",e.style.cursor=""):(e.style.userSelect="none",e.style.WebkitUserSelect="none",e.style.cursor="grab")}function st(e){e.style.display="none",e.style.position="fixed",e.style.zIndex="-5"}function sn(e){e.style.visibility="hidden",e.setAttribute(ye,"true")}function an(e){e.style.visibility="",e.removeAttribute(ye)}function Ae(e,t=()=>{},n=()=>[]){e.forEach(r=>{const i=t(r);Object.keys(i).forEach(o=>{r.style[o]=i[o]}),n(r).forEach(o=>r.classList.add(o))})}function _e(e,t=()=>{},n=()=>[]){e.forEach(r=>{const i=t(r);Object.keys(i).forEach(o=>{r.style[o]=""}),n(r).forEach(o=>r.classList.contains(o)&&r.classList.remove(o))})}function dn(e){const t=e.style.minHeight;e.style.minHeight=window.getComputedStyle(e).getPropertyValue("height");const n=e.style.minWidth;return e.style.minWidth=window.getComputedStyle(e).getPropertyValue("width"),function(){e.style.minHeight=t,e.style.minWidth=n}}const ln="--any--",cn=100,un=20,Oe=3,fn=80,at={outline:"rgba(255, 255, 102, 0.7) solid 2px"},dt="data-is-dnd-original-dragged-item";let R,T,P,Ie,m,Re,re,b,Z,S,j=!1,ze=!1,Ge,ce=!1,ue=[],fe,H,ge=!1;const k=new Map,D=new Map,Be=new WeakMap;function gn(e,t){u(()=>"registering drop-zone if absent"),k.has(t)||k.set(t,new Set),k.get(t).has(e)||(k.get(t).add(e),Ke())}function lt(e,t){k.get(t).delete(e),Xe(),k.get(t).size===0&&k.delete(t)}function hn(){u(()=>"watching dragged element");const e=k.get(Ie);for(const r of e)r.addEventListener(me,ct),r.addEventListener(ae,ut),r.addEventListener(pe,ft);window.addEventListener(Ce,ie);const t=Math.max(...Array.from(e.keys()).map(r=>D.get(r).dropAnimationDurationMs)),n=t===0?un:Math.max(t,cn);fe=Kt(e,()=>S),Wt(T,e,n*1.07,fe)}function En(){u(()=>"unwatching dragged element");const e=k.get(Ie);for(const t of e)t.removeEventListener(me,ct),t.removeEventListener(ae,ut),t.removeEventListener(pe,ft);window.removeEventListener(Ce,ie),fe&&(fe.destroy(),fe=void 0),Yt()}function Se(e){return e.findIndex(t=>!!t[te])}function mn(e){return{...e,[te]:!0,[_]:Ve,[we]:e[_]}}function ct(e){u(()=>["dragged entered",e.currentTarget,e.detail]);let{items:t,dropFromOthersDisabled:n}=D.get(e.currentTarget);if(n&&e.currentTarget!==m){u(()=>"ignoring dragged entered because drop is currently disabled");return}if(ce=!1,t=t.filter(a=>!a[te]),u(()=>`dragged entered items ${$(t)}`),m!==e.currentTarget){const s=D.get(m).items.filter(c=>!c[te]);Y(m,s,{trigger:v.DRAGGED_ENTERED_ANOTHER,id:P[_],source:A.POINTER})}const{index:r,isProximityBased:i}=e.detail.indexObj,o=i&&r===e.currentTarget.children.length-1?r+1:r;b=e.currentTarget,t.splice(o,0,re),Y(e.currentTarget,t,{trigger:v.DRAGGED_ENTERED,id:P[_],source:A.POINTER})}function ut(e){if(!j)return;u(()=>["dragged left",e.currentTarget,e.detail]);const{items:t,dropFromOthersDisabled:n}=D.get(e.currentTarget);if(n&&e.currentTarget!==m&&e.currentTarget!==b){u(()=>"drop is currently disabled");return}const r=[...t],i=Se(r);i!==-1&&r.splice(i,1);const o=b;b=void 0;const{type:a,theOtherDz:s}=e.detail;if(a===De.OUTSIDE_OF_ANY||a===De.LEFT_FOR_ANOTHER&&s!==m&&D.get(s).dropFromOthersDisabled){u(()=>"dragged left all, putting shadow element back in the origin dz"),ce=!0,b=m;const c=o===m?r:[...D.get(m).items];c.splice(Re,0,re),Y(m,c,{trigger:v.DRAGGED_LEFT_ALL,id:P[_],source:A.POINTER})}Y(e.currentTarget,r,{trigger:v.DRAGGED_LEFT,id:P[_],source:A.POINTER})}function ft(e){u(()=>["dragged is over index",e.currentTarget,e.detail]);const{items:t,dropFromOthersDisabled:n}=D.get(e.currentTarget);if(n&&e.currentTarget!==m){u(()=>"drop is currently disabled");return}const r=[...t];ce=!1;const{index:i}=e.detail.indexObj,o=Se(r);o!==-1&&r.splice(o,1),r.splice(i,0,re),Y(e.currentTarget,r,{trigger:v.DRAGGED_OVER_INDEX,id:P[_],source:A.POINTER})}function xe(e){e.preventDefault();const t=e.touches?e.touches[0]:e;S={x:t.clientX,y:t.clientY},T.style.transform=`translate3d(${S.x-Z.x}px, ${S.y-Z.y}px, 0)`}function ie(){u(()=>"dropped"),ze=!0,window.removeEventListener("mousemove",xe),window.removeEventListener("touchmove",xe),window.removeEventListener("mouseup",ie),window.removeEventListener("touchend",ie),En(),nn(T),b||(u(()=>"element was dropped right after it left origin but before entering somewhere else"),b=m),u(()=>["dropped in dz",b]);let{items:e,type:t}=D.get(b);_e(k.get(t),i=>D.get(i).dropTargetStyle,i=>D.get(i).dropTargetClasses);let n=Se(e);n===-1&&b===m&&(n=Re),e=e.map(i=>i[te]?P:i);function r(){Ge(),ee(b,e,{trigger:ce?v.DROPPED_OUTSIDE_OF_ANY:v.DROPPED_INTO_ZONE,id:P[_],source:A.POINTER}),b!==m&&ee(m,D.get(m).items,{trigger:v.DROPPED_INTO_ANOTHER,id:P[_],source:A.POINTER});const i=Array.from(b.children).find(o=>o.getAttribute(ye));i&&an(i),yn()}D.get(b).dropAnimationDisabled?r():pn(n,r)}function pn(e,t){const n=e>-1?Fe(b.children[e],!1):Fe(b,!1),r={x:n.left-parseFloat(T.style.left),y:n.top-parseFloat(T.style.top)},{dropAnimationDurationMs:i}=D.get(b),o=`transform ${i}ms ease`;T.style.transition=T.style.transition?T.style.transition+","+o:o,T.style.transform=`translate3d(${r.x}px, ${r.y}px, 0)`,window.setTimeout(t,i)}function Dn(e,t){ue.push({dz:e,destroy:t}),window.requestAnimationFrame(()=>{st(e),document.body.appendChild(e)})}function yn(){T&&T.remove&&T.remove(),R&&R.remove&&R.remove(),T=void 0,R=void 0,P=void 0,Ie=void 0,m=void 0,Re=void 0,re=void 0,b=void 0,Z=void 0,S=void 0,j=!1,ze=!1,Ge=void 0,ce=!1,H&&clearTimeout(H),H=void 0,ge=!1,ue.length&&(u(()=>["will destroy zones that were removed during drag",ue]),ue.forEach(({dz:e,destroy:t})=>{t(),e.remove()}),ue=[])}function wn(e,t){let n=!1;const r={items:void 0,type:void 0,flipDurationMs:0,dragDisabled:!1,morphDisabled:!1,dropFromOthersDisabled:!1,dropTargetStyle:at,dropTargetClasses:[],transformDraggedElement:()=>{},centreDraggedOnCursor:!1,dropAnimationDisabled:!1,delayTouchStartMs:0};u(()=>[`dndzone good to go options: ${$(t)}, config: ${$(r)}`,{node:e}]);let i=new Map;function o(){window.addEventListener("mousemove",c,{passive:!1}),window.addEventListener("touchmove",c,{passive:!1,capture:!1}),window.addEventListener("mouseup",s,{passive:!1}),window.addEventListener("touchend",s,{passive:!1})}function a(){window.removeEventListener("mousemove",c),window.removeEventListener("touchmove",c),window.removeEventListener("mouseup",s),window.removeEventListener("touchend",s),H&&(clearTimeout(H),H=void 0,ge=!1)}function s(d){if(a(),R=void 0,Z=void 0,S=void 0,d.type==="touchend"){const f=new Event("click",{bubbles:!0,cancelable:!0});d.target.dispatchEvent(f)}}function c(d){const f=!!d.touches,h=f?d.touches[0]:d;if(f&&r.delayTouchStartMs>0&&!ge){S={x:h.clientX,y:h.clientY},(Math.abs(S.x-Z.x)>=Oe||Math.abs(S.y-Z.y)>=Oe)&&(H&&(clearTimeout(H),H=void 0),s(d));return}d.preventDefault(),S={x:h.clientX,y:h.clientY},(Math.abs(S.x-Z.x)>=Oe||Math.abs(S.y-Z.y)>=Oe)&&(a(),l())}function g(d){if(d.target!==d.currentTarget&&(d.target.value!==void 0||d.target.isContentEditable)){u(()=>"won't initiate drag on a nested input element");return}if(d.button){u(()=>`ignoring none left click button: ${d.button}`);return}if(j){u(()=>"cannot start a new drag before finalizing previous one");return}const f=!!d.touches,h=f&&r.delayTouchStartMs>0;h||d.preventDefault(),d.stopPropagation();const M=f?d.touches[0]:d;Z={x:M.clientX,y:M.clientY},S={...Z},R=d.currentTarget,h&&(ge=!1,H=window.setTimeout(()=>{R&&(ge=!0,a(),l())},r.delayTouchStartMs)),o()}function l(){u(()=>[`drag start config: ${$(r)}`,R]),j=!0;const d=i.get(R);Re=d,m=R.parentElement;const f=m.closest("dialog")||m.closest("[popover]")||m.getRootNode(),h=f.body||f,{items:M,type:W,centreDraggedOnCursor:U}=r,N=[...M];P=N[d],Ie=W,re=mn(P),T=tn(R,U&&S),h.appendChild(T);function L(){if(!R){u(()=>"originalDragTarget became undefined, aborting keepOriginalElementInDom");return}R.parentElement?window.requestAnimationFrame(L):(R.setAttribute(dt,!0),h.appendChild(R),hn(),st(R),T.focus())}window.requestAnimationFrame(L),Ae(Array.from(k.get(r.type)).filter(p=>p===m||!D.get(p).dropFromOthersDisabled),p=>D.get(p).dropTargetStyle,p=>D.get(p).dropTargetClasses),N.splice(d,1,re),Ge=dn(m),Y(m,N,{trigger:v.DRAG_STARTED,id:P[_],source:A.POINTER}),window.addEventListener("mousemove",xe,{passive:!1}),window.addEventListener("touchmove",xe,{passive:!1,capture:!1}),window.addEventListener("mouseup",ie,{passive:!1}),window.addEventListener("touchend",ie,{passive:!1})}function E({items:d=void 0,flipDurationMs:f=0,type:h=ln,dragDisabled:M=!1,morphDisabled:W=!1,dropFromOthersDisabled:U=!1,dropTargetStyle:N=at,dropTargetClasses:L=[],transformDraggedElement:p=()=>{},centreDraggedOnCursor:Ln=!1,dropAnimationDisabled:Mn=!1,delayTouchStart:Ee=!1}){r.dropAnimationDurationMs=f;let Ye=0;Ee===!0?Ye=fn:typeof Ee=="number"&&isFinite(Ee)&&Ee>=0&&(Ye=Ee),r.delayTouchStartMs=Ye,r.type&&h!==r.type&&lt(e,r.type),r.type=h,r.items=[...d],r.dragDisabled=M,r.morphDisabled=W,r.transformDraggedElement=p,r.centreDraggedOnCursor=Ln,r.dropAnimationDisabled=Mn,n&&j&&!ze&&(!Zt(N,r.dropTargetStyle)||!Ht(L,r.dropTargetClasses))&&(_e([e],()=>r.dropTargetStyle,()=>L),Ae([e],()=>N,()=>L)),r.dropTargetStyle=N,r.dropTargetClasses=[...L];function Me(I,C){return D.get(I)?D.get(I)[C]:r[C]}n&&j&&r.dropFromOthersDisabled!==U&&(U?_e([e],I=>Me(I,"dropTargetStyle"),I=>Me(I,"dropTargetClasses")):Ae([e],I=>Me(I,"dropTargetStyle"),I=>Me(I,"dropTargetClasses"))),r.dropFromOthersDisabled=U,D.set(e,r),gn(e,h);const Cn=j?Se(r.items):-1;for(let I=0;I<e.children.length;I++){const C=e.children[I];if(on(C,M),I===Cn){W||rn(T,C,S.x,S.y),r.transformDraggedElement(T,P,I),sn(C);continue}C.removeEventListener("mousedown",Be.get(C)),C.removeEventListener("touchstart",Be.get(C)),M||(C.addEventListener("mousedown",g),C.addEventListener("touchstart",g),Be.set(C,g)),i.set(C,I),n||(n=!0)}}return E(t),{update:d=>{u(()=>`pointer dndzone will update newOptions: ${$(d)}`),E(d)},destroy:()=>{function d(){u(()=>"pointer dndzone will destroy"),lt(e,D.get(e).type),D.delete(e)}j&&!e.closest(`[${dt}]`)?(u(()=>"pointer dndzone will be scheduled for destruction"),Dn(e,d)):d()}}}const Ze={DND_ZONE_ACTIVE:"dnd-zone-active",DND_ZONE_DRAG_DISABLED:"dnd-zone-drag-disabled"},gt={[Ze.DND_ZONE_ACTIVE]:"Tab to one the items and press space-bar or enter to start dragging it",[Ze.DND_ZONE_DRAG_DISABLED]:"This is a disabled drag and drop list"},Tn="dnd-action-aria-alert";let w;function He(){w||(w=document.createElement("div"),function(){w.id=Tn,w.style.position="fixed",w.style.bottom="0",w.style.left="0",w.style.zIndex="-5",w.style.opacity="0",w.style.height="0",w.style.width="0",w.setAttribute("role","alert")}(),document.body.prepend(w),Object.entries(gt).forEach(([e,t])=>document.body.prepend(An(e,t))))}function bn(){return Pe?null:(document.readyState==="complete"?He():window.addEventListener("DOMContentLoaded",He),{...Ze})}function vn(){Pe||!w||(Object.keys(gt).forEach(e=>document.getElementById(e)?.remove()),w.remove(),w=void 0)}function An(e,t){const n=document.createElement("div");return n.id=e,n.innerHTML=`<p>${t}</p>`,n.style.display="none",n.style.position="fixed",n.style.zIndex="-5",n}function q(e){if(Pe)return;w||He(),w.innerHTML="";const t=document.createTextNode(e);w.appendChild(t),w.style.display="none",w.style.display="inline"}const _n="--any--",ht={outline:"rgba(255, 255, 102, 0.7) solid 2px"};let F=!1,Ue,x,J="",Q,z,K="";const Ne=new WeakSet,Et=new WeakMap,mt=new WeakMap,We=new Map,O=new Map,G=new Map;let Le;function On(e,t){u(()=>"registering drop-zone if absent"),G.size===0&&(u(()=>"adding global keydown and click handlers"),Le=bn(),window.addEventListener("keydown",Dt),window.addEventListener("click",yt)),G.has(t)||G.set(t,new Set),G.get(t).has(e)||(G.get(t).add(e),Ke())}function pt(e,t){u(()=>"unregistering drop-zone"),x===e&&he(),G.get(t).delete(e),Xe(),G.get(t).size===0&&G.delete(t),G.size===0&&(u(()=>"removing global keydown and click handlers"),window.removeEventListener("keydown",Dt),window.removeEventListener("click",yt),Le=void 0,vn())}function Dt(e){if(F)switch(e.key){case"Escape":{he();break}}}function yt(){F&&(Ne.has(document.activeElement)||(u(()=>"clicked outside of any draggable"),he()))}function In(e){if(u(()=>"zone focus"),!F)return;const t=e.currentTarget;if(t===x)return;J=t.getAttribute("aria-label")||"";const{items:n}=O.get(x),r=n.find(g=>g[_]===z),i=n.indexOf(r),o=n.splice(i,1)[0],{items:a,autoAriaDisabled:s}=O.get(t);t.getBoundingClientRect().top<x.getBoundingClientRect().top||t.getBoundingClientRect().left<x.getBoundingClientRect().left?(a.push(o),s||q(`Moved item ${K} to the end of the list ${J}`)):(a.unshift(o),s||q(`Moved item ${K} to the beginning of the list ${J}`)),ee(x,n,{trigger:v.DROPPED_INTO_ANOTHER,id:z,source:A.KEYBOARD}),ee(t,a,{trigger:v.DROPPED_INTO_ZONE,id:z,source:A.KEYBOARD}),x=t}function wt(){We.forEach(({update:e},t)=>e(O.get(t)))}function he(e=!0){u(()=>"drop"),O.get(x).autoAriaDisabled||q(`Stopped dragging item ${K}`),Ne.has(document.activeElement)&&document.activeElement.blur(),e&&Y(x,O.get(x).items,{trigger:v.DRAG_STOPPED,id:z,source:A.KEYBOARD}),_e(G.get(Ue),t=>O.get(t).dropTargetStyle,t=>O.get(t).dropTargetClasses),Q=null,z=null,K="",Ue=null,x=null,J="",F=!1,wt()}function Rn(e,t){const n={items:void 0,type:void 0,dragDisabled:!1,zoneTabIndex:0,zoneItemTabIndex:0,dropFromOthersDisabled:!1,dropTargetStyle:ht,dropTargetClasses:[],autoAriaDisabled:!1};function r(l,E,d){l.length<=1||l.splice(d,1,l.splice(E,1,l[d])[0])}function i(l){switch(u(()=>["handling key down",l.key]),l.key){case"Enter":case" ":{if((l.target.disabled!==void 0||l.target.href||l.target.isContentEditable)&&!Ne.has(l.target))return;l.preventDefault(),l.stopPropagation(),F?he():o(l);break}case"ArrowDown":case"ArrowRight":{if(!F)return;l.preventDefault(),l.stopPropagation();const{items:E}=O.get(e),d=Array.from(e.children),f=d.indexOf(l.currentTarget);u(()=>["arrow down",f]),f<d.length-1&&(n.autoAriaDisabled||q(`Moved item ${K} to position ${f+2} in the list ${J}`),r(E,f,f+1),ee(e,E,{trigger:v.DROPPED_INTO_ZONE,id:z,source:A.KEYBOARD}));break}case"ArrowUp":case"ArrowLeft":{if(!F)return;l.preventDefault(),l.stopPropagation();const{items:E}=O.get(e),f=Array.from(e.children).indexOf(l.currentTarget);u(()=>["arrow up",f]),f>0&&(n.autoAriaDisabled||q(`Moved item ${K} to position ${f} in the list ${J}`),r(E,f,f-1),ee(e,E,{trigger:v.DROPPED_INTO_ZONE,id:z,source:A.KEYBOARD}));break}}}function o(l){u(()=>"drag start"),s(l.currentTarget),x=e,Ue=n.type,F=!0;const E=Array.from(G.get(n.type)).filter(d=>d===x||!O.get(d).dropFromOthersDisabled);if(Ae(E,d=>O.get(d).dropTargetStyle,d=>O.get(d).dropTargetClasses),!n.autoAriaDisabled){let d=`Started dragging item ${K}. Use the arrow keys to move it within its list ${J}`;E.length>1&&(d+=", or tab to another list in order to move the item into it"),q(d)}Y(e,O.get(e).items,{trigger:v.DRAG_STARTED,id:z,source:A.KEYBOARD}),wt()}function a(l){F&&l.currentTarget!==Q&&(l.stopPropagation(),he(!1),o(l))}function s(l){const{items:E}=O.get(e),d=Array.from(e.children),f=d.indexOf(l);Q=l,Q.tabIndex=n.zoneItemTabIndex,z=E[f][_],K=d[f].getAttribute("aria-label")||""}function c({items:l=[],type:E=_n,dragDisabled:d=!1,zoneTabIndex:f=0,zoneItemTabIndex:h=0,dropFromOthersDisabled:M=!1,dropTargetStyle:W=ht,dropTargetClasses:U=[],autoAriaDisabled:N=!1}){n.items=[...l],n.dragDisabled=d,n.dropFromOthersDisabled=M,n.zoneTabIndex=f,n.zoneItemTabIndex=h,n.dropTargetStyle=W,n.dropTargetClasses=U,n.autoAriaDisabled=N,n.type&&E!==n.type&&pt(e,n.type),n.type=E,On(e,E),N||(e.setAttribute("aria-disabled",d),e.setAttribute("role","list"),e.setAttribute("aria-describedby",d?Le.DND_ZONE_DRAG_DISABLED:Le.DND_ZONE_ACTIVE)),O.set(e,n),F?e.tabIndex=e===x||Q.contains(e)||n.dropFromOthersDisabled||x&&n.type!==O.get(x).type?-1:0:e.tabIndex=n.zoneTabIndex,e.addEventListener("focus",In);for(let L=0;L<e.children.length;L++){const p=e.children[L];Ne.add(p),p.tabIndex=F?-1:n.zoneItemTabIndex,N||p.setAttribute("role","listitem"),p.removeEventListener("keydown",Et.get(p)),p.removeEventListener("click",mt.get(p)),d||(p.addEventListener("keydown",i),Et.set(p,i),p.addEventListener("click",a),mt.set(p,a)),F&&n.items[L][_]===z&&(u(()=>["focusing on",{i:L,focusedItemId:z}]),Q=p,Q.tabIndex=n.zoneItemTabIndex,p.focus())}}c(t);const g={update:l=>{u(()=>`keyboard dndzone will update newOptions: ${$(l)}`),c(l)},destroy:()=>{u(()=>"keyboard dndzone will destroy"),pt(e,n.type),O.delete(e),We.delete(e)}};return We.set(e,g),g}function Tt(e,t){if(Sn(e))return{update:()=>{},destroy:()=>{}};bt(t);const n=wn(e,t),r=Rn(e,t);return{update:i=>{bt(i),n.update(i),r.update(i)},destroy:()=>{n.destroy(),r.destroy()}}}function Sn(e){return!!e.closest(`[${Lt}="true"]`)}function bt(e){const{items:t,flipDurationMs:n,type:r,dragDisabled:i,morphDisabled:o,dropFromOthersDisabled:a,zoneTabIndex:s,zoneItemTabIndex:c,dropTargetStyle:g,dropTargetClasses:l,transformDraggedElement:E,autoAriaDisabled:d,centreDraggedOnCursor:f,delayTouchStart:h,dropAnimationDisabled:M,...W}=e;if(Object.keys(W).length>0&&console.warn("dndzone will ignore unknown options",W),!t)throw new Error("no 'items' key provided to dndzone");const U=t.find(N=>!{}.hasOwnProperty.call(N,_));if(U)throw new Error(`missing '${_}' property for item ${$(U)}`);if(l&&!Array.isArray(l))throw new Error(`dropTargetClasses should be an array but instead it is a ${typeof l}, ${$(l)}`);if(s&&!vt(s))throw new Error(`zoneTabIndex should be a number but instead it is a ${typeof s}, ${$(s)}`);if(c&&!vt(c))throw new Error(`zoneItemTabIndex should be a number but instead it is a ${typeof c}, ${$(c)}`);if(h!==void 0&&h!==!1){const N=h===!0,L=typeof h=="number"&&isFinite(h)&&h>=0;if(!N&&!L)throw new Error(`delayTouchStart should be a boolean (true/false) or a non-negative number but instead it is a ${typeof h}, ${$(h)}`)}}function vt(e){return!isNaN(e)&&function(t){return(t|0)===t}(parseFloat(e))}function At(e){let t=e;const n=new Set;return{get:()=>t,set:r=>{t=r,Array.from(n).forEach(i=>i(t))},subscribe:r=>{n.add(r),r(t)},unsubscribe:r=>{n.delete(r)}}}const B=At(!0),oe=At(!1);function _t(){return{dragDisabled:oe.get()||B.get(),zoneItemTabIndex:-1}}function xn(e,t){oe.set(t?.dragDisabled??!1);let n=t;const r=Tt(e,{...n,..._t()});function i(){r.update({...n,..._t()})}B.subscribe(i);function o(s){const{info:{source:c,trigger:g}}=s.detail;c===A.KEYBOARD&&g===v.DRAG_STOPPED&&B.set(!0)}function a(s){const{info:{source:c}}=s.detail;c===A.POINTER&&B.set(!0)}return e.addEventListener("consider",o),e.addEventListener("finalize",a),{update:s=>{n=s,oe.set(n?.dragDisabled??!1),i()},destroy:()=>{e.removeEventListener("consider",o),e.removeEventListener("finalize",a),B.unsubscribe(i)}}}function Nn(e){e.setAttribute("role","button");function t(o){o.preventDefault(),B.set(!1),window.addEventListener("mouseup",r),window.addEventListener("touchend",r)}function n(o){(o.key==="Enter"||o.key===" ")&&B.set(!1)}function r(){B.set(!0),window.removeEventListener("mouseup",r),window.removeEventListener("touchend",r)}const i=()=>{const o=oe.get(),a=B.get();o?(e.tabIndex=-1,e.style.cursor=""):(e.tabIndex=a?0:-1,e.style.cursor=a?"grab":"grabbing")};return oe.subscribe(i),B.subscribe(i),e.addEventListener("mousedown",t),e.addEventListener("touchstart",t),e.addEventListener("keydown",n),{update:()=>{},destroy:()=>{e.removeEventListener("mousedown",t),e.removeEventListener("touchstart",t),e.removeEventListener("keydown",n),oe.unsubscribe(i),B.unsubscribe(i)}}}y.DRAGGED_ELEMENT_ID=je,y.FEATURE_FLAG_NAMES=V,y.SHADOW_BACKUP_ID_PROPERTY_NAME=we,y.SHADOW_ITEM_MARKER_PROPERTY_NAME=te,y.SHADOW_PLACEHOLDER_ITEM_ID=Ve,y.SOURCES=A,y.TRIGGERS=v,y.alertToScreenReader=q,y.dndzone=Tt,y.dragHandle=Nn,y.dragHandleZone=xn,y.getTrueItemId=Ct,y.overrideItemIdKeyNameBeforeInitialisingDndZones=Mt,y.setDebugMode=Pt,y.setFeatureFlag=Qt,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.js.map
